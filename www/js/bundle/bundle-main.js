(()=>{var e,t,n={638:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=638,e.exports=t},855:(e,t,n)=>{var a={"./Catalog.js":[99,99],"./Chat.js":[388],"./Checks.js":[943],"./Content.js":[913],"./Discover.js":[805,805],"./FeedReader.js":[845,845],"./Feeds.js":[849,849],"./FileBrowser.js":[734,734],"./Folder.js":[546,546],"./Home.js":[789],"./Settings.js":[491,491],"./Sidebar.js":[216],"./renderers/CheatSheet.js":[209],"./renderers/Pdf.js":[965]};function s(e){if(!n.o(a,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],s=t[0];return Promise.all(t.slice(1).map(n.e)).then((()=>n(s)))}s.keys=()=>Object.keys(a),s.id=855,e.exports=s},755:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=755,e.exports=t},189:(e,t,n)=>{"use strict";n.d(t,{q:()=>O});var a=n(388),s=n(662),i=n(551);class r{static commands={help:{syntax:"help",summary:"Show this help again",func:()=>["text",this.help()]},base64:{syntax:"base64 [-d] <string>",summary:"string <-> base64",func:e=>"-d"!==e[1]?["text",btoa(e[2])]:["text",atob(e[1])]},cw:{syntax:"cw",summary:"Print calendar weeks",func:()=>{const e=new Date,t=e=>{const t=new Date(e);return t.setDate(t.getDate()+3),Math.ceil(Math.ceil((t.getTime()-new Date(t.getFullYear(),0,1).getTime())/864e5)/7)};return["text",`Current week is ${t(e)}\n\nFollowing weeks are:\n`+Array.from({length:10},((e,t)=>t+1)).map((n=>{const a=new Date(e);return a.setDate(a.getDate()+(1-a.getDay())),a.setDate(a.getDate()+7*n),`week ${t(a)} --- Monday ${a.toLocaleDateString()}`})).join("\n")]}},cat:{syntax:"cat <filename>",summary:"Read file from OPFS",func:async e=>{const t=e[1],n=await navigator.storage.getDirectory();try{const e=await n.getFileHandle(t),a=await e.getFile();return["text",await a.text()]}catch(e){return["text",`ERROR: File ${t} not found.`]}}},curl:{syntax:"curl <URL> [>filename.ext]",summary:"Fetch URL using CORS proxy and optionally save to OPFS",func:async e=>{const t=e[1],n=await fetch(t);if(!n.ok)return["text",`ERROR: ${n.status} ${n.statusText}`];const a=await n.text();if(e[2]&&e[2].startsWith(">")){const t=e[2].substring(1).trim(),n=await navigator.storage.getDirectory(),s=await n.getFileHandle(t,{create:!0}),i=await s.createWritable();return await i.write(a),await i.close(),["text",`Saved to ${t}`]}return["text",a]}},date:{syntax:"date <epoch>",summary:"epoch -> date",func:(e,t)=>["text",new Date(parseInt(t))]},epoch:{syntax:"epoch <date>",summary:"date -> epoch",func:(e,t)=>{const n=new Date(t).getTime();return["text",`Epoch [ms] : ${n}\nUnix epoch : ${n/1e3}`]}},ip:{syntax:"ip",summary:"Print IP (https://ifconfig.me)",func:async()=>{const e=await fetch("https://ifconfig.me/all.json"),t=await e.json();return console.log(t),["text",t.ip_addr]}},ipcalc:{syntax:"ipcalc <CIDR>",summary:"Calculate address range",func:e=>{const t=this.#e(e[1]);return["text",`Base      : ${t[0]}\nBroadcast : ${t[1]}`]}},ls:{syntax:"ls",summary:"List all files/directories in the OPFS root",func:async()=>{const e=await navigator.storage.getDirectory(),t=[];for await(const[n,a]of e.entries())t.push(`${"directory"===a.kind?"üìÅ":"üìÑ"} ${n}`);return 0===t.length?["text","No entries in OPFS found."]:["text",t.sort().join("\n")]}},mkdir:{syntax:"mkdir <dirname>",summary:"Create directory in OPFS root",func:async e=>{const t=e[1],n=await navigator.storage.getDirectory();try{return await n.getDirectoryHandle(t,{create:!0}),["text",`Created directory ${t}`]}catch(e){return["text",`ERROR: Could not create directory ${t}.`]}}},mkpasswd:{syntax:"mkpasswd [<len>] [<chars>]",summary:"Random password",func:e=>["text",this.#t(e[1]?parseInt(e[1]):void 0,e[2])]},qr:{syntax:"qr <URL>",summary:"Create QR code",func:(e,t)=>["html",`<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURI(t)}"/>`]},rm:{syntax:"rm <filename>",summary:"Remove file from OPFS",func:async e=>{const t=e[1],n=await navigator.storage.getDirectory();try{return await n.removeEntry(t),["text",`Removed ${t}`]}catch(e){return["text",`ERROR: File ${t} not found.`]}}},si:{syntax:"si <value MB>",summary:"Print power 2 values",func:e=>{const t=parseInt(e[1]);return["text",`${1024*t} KiB\n${t/1024} GiB\n${t/1024/1024} TiB`]}},setting:{syntax:"setting <name>",summary:"Get a setting value",func:async e=>["text",JSON.stringify(await i.w.get(e[1],""))]},weather:{syntax:"weather",summary:"Embed weather map",func:()=>(document.getElementById("CommandsViewEmbed")?.remove(),a.ChatView.addToolResult("weather",'<div id="CommandsViewEmbed">Loading weather widget...</div>',"html"),navigator.geolocation.getCurrentPosition((e=>{const t=e.coords;console.log("Your current position is:"),console.log(`Latitude : ${t.latitude}`),console.log(`Longitude: ${t.longitude}`),console.log(`More or less ${t.accuracy} meters.`);const n=e.coords.latitude,a=e.coords.longitude;document.getElementById("CommandsViewEmbed").innerHTML=`<iframe frameborder="0" src="https://imweather.com/widget/map?lat=${n}&lng=${a}&z=6.20&model=nowcast&element=radar_obs&values=true" style="height:400px;width:100%;max-width:640px;"></iframe>`}),(e=>{document.getElementById("CommandsViewEmbed").innerHTML=`Fetching Geo position failed (Error ${e.code}: ${e.message})!`}),{enableHighAccuracy:!1,timeout:2e4,maximumAge:100}),[void 0,void 0])},webamp:{syntax:"webamp",summary:"Embed music player",func:()=>{if(document.getElementById("webampApp"))window.webamp.reopen();else{const e=document.createElement("div");e.id="webampApp",document.body.appendChild(e),s.u.get("lib_webamp").then((()=>{const e=document.getElementById("webampApp");window.webamp=new Webamp,window.webamp.renderWhenReady(e)}))}return["text","Opening webamp."]}}};static register(e){r.commands={...r.commands,...e}}static isValid=e=>Object.hasOwn(r.commands,e.split(/\s+/)[0]);static help=()=>"Syntax:\n\n    <query>             # Search all cheat sheets\n    ?<query>            # Perform a chat bot query\n    !<command>          # Run a command\n\nCommands:\n\n"+Object.entries(r.commands).sort(((e,t)=>e[0].localeCompare(t[0]))).map((e=>"    "+e[1].syntax+" ".repeat(30-e[1].syntax.length)+" # "+e[1].summary)).join("\n");static#t(e,t){if(void 0===e)e=32;else if(!Number.isInteger(e)||e<=0)throw new Error("len must be a positive integer");if(void 0===t)t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789√§√º√∂√Ñ√ú√ñ_-+=/¬∞^`'\"|#@!.";else{if("string"!=typeof t)throw new Error("chars must be a string");if(t.length>256)throw new Error("chars must be <= 256")}const n=256-256%t.length;let a,s="";for(let i=0;i<e;i++){do{a=window.crypto.getRandomValues(new Uint8Array(1))[0]}while(a>=n);s+=t[a%t.length]}return s}static#e(e){var t=e.split("/"),n=t[0].split("."),a=["0","0","0","0"],s=(a=/\d+\.\d+\.\d+\.\d+/.test(t[1])?t[1].split(".").map((function(e){return parseInt(e,10)})):(a=("1".repeat(parseInt(t[1],10))+"0".repeat(32-parseInt(t[1],10))).match(/.{1,8}/g)).map((function(e){return parseInt(e,2)}))).map((function(e){return 255^e})),i=n.map((function(e,t){return e&a[t]})),r=i.map((function(e,t){return e|s[t]}));return[i.join("."),r.join(".")]}static async run(e){try{const t=e.split(/\s/),n=e.substring(t[0].length);return void 0===r.commands[t[0]]?["text","Unknown command"]:await r.commands[t[0]].func(t,n)}catch(e){return["text",`ERROR: Exception (${e})`]}}}var o=n(913),d=n(84);class c{static addEvent(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)}static removeEvent(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n)}static jtdSearchLoaded=function(e,t){var n,a=document.getElementById("search-input"),s=document.getElementById("search-results"),i=0;function r(){document.documentElement.classList.remove("search-active")}function o(){i++;var o=a.value;if(""===o?r():(document.documentElement.classList.add("search-active"),window.scroll(0,-1),setTimeout((function(){window.scroll(0,0)}),0)),o!==n&&(n=o,s.innerHTML="",""!==o)){var d=e.query((function(e){var t=window.lunr.tokenizer(o);e.term(t,{boost:10}),e.term(t,{wildcard:window.lunr.Query.wildcard.TRAILING})}));if(0==d.length&&o.length>2){var c=window.lunr.tokenizer(o).filter((function(e){return e.str.length<20}));c.length>0&&(d=e.query((function(e){e.term(c,{editDistance:Math.round(Math.sqrt(o.length/2-1))})})))}if(0==d.length){var l=document.createElement("div");l.classList.add("search-no-result"),l.innerText="No results found",s.appendChild(l)}else{var u=document.createElement("ul");u.classList.add("search-results-list"),s.appendChild(u),function e(t,n,a,s,r,o){if(o==i){for(var d=a;d<a+s;d++){if(d==n.length)return;h(t,n[d])}setTimeout((function(){e(t,n,a+s,s,r,o)}),r)}}(u,d,0,10,100,i)}}function h(e,n){var a=t[n.ref],s=document.createElement("li");s.classList.add("search-results-list-item"),e.appendChild(s);var i=document.createElement("a");i.classList.add("search-result"),i.setAttribute("href",a.relUrl),s.appendChild(i);var r=document.createElement("div");r.classList.add("search-result-title"),i.appendChild(r);var o=document.createElement("div");o.classList.add("search-result-doc"),o.innerHTML='<svg viewBox="0 0 24 24" class="search-result-icon"><use xlink:href="#svg-doc"></use></svg>',r.appendChild(o);var d=document.createElement("div");d.classList.add("search-result-doc-title"),d.innerHTML=a.doc,o.appendChild(d);var c=d;if(a.doc!=a.title){o.classList.add("search-result-doc-parent");var l=document.createElement("div");l.classList.add("search-result-section"),l.innerHTML=a.title,r.appendChild(l),c=l}var u=n.matchData.metadata,h=[],m=[];for(var f in u){var g=u[f];if(g.title){let e=g.title.position;for(let t in e)h.push(e[t])}if(g.content){let e=g.content.position;for(let t in e){var w=e[t],v=w[0],y=w[0]+w[1],b=!0,x=!0;for(let e=0;e<5;e++){let e=a.content.lastIndexOf(" ",v-2),t=a.content.lastIndexOf(". ",v-2);if(t>=0&&t>e){v=t+1,b=!1;break}if(e<0){v=0,b=!1;break}v=e+1}for(let e=0;e<10;e++){let e=a.content.indexOf(" ",y+1),t=a.content.indexOf(". ",y+1);if(t>=0&&t<e){y=t,x=!1;break}if(e<0){y=a.content.length,x=!1;break}y=e}m.push({highlight:w,previewStart:v,previewEnd:y,ellipsesBefore:b,ellipsesAfter:x})}}}if(h.length>0&&(h.sort((function(e,t){return e[0]-t[0]})),c.innerHTML="",p(c,a.title,0,a.title.length,h)),m.length>0){m.sort((function(e,t){return e.highlight[0]-t.highlight[0]}));var E=m[0],I={highlight:[E.highlight],previewStart:E.previewStart,previewEnd:E.previewEnd,ellipsesBefore:E.ellipsesBefore,ellipsesAfter:E.ellipsesAfter},C=[I];for(let e=1;e<m.length;e++)E=m[e],I.previewEnd<E.previewStart?(I={highlight:[E.highlight],previewStart:E.previewStart,previewEnd:E.previewEnd,ellipsesBefore:E.ellipsesBefore,ellipsesAfter:E.ellipsesAfter},C.push(I)):(I.highlight.push(E.highlight),I.previewEnd=E.previewEnd,I.ellipsesAfter=E.ellipsesAfter);var k=document.createElement("div");k.classList.add("search-result-previews"),i.appendChild(k);var R=a.content;for(let e=0;e<Math.min(C.length,3);e++){let t=C[e];var S=document.createElement("div");S.classList.add("search-result-preview"),k.appendChild(S),t.ellipsesBefore&&S.appendChild(document.createTextNode("... ")),p(S,R,t.previewStart,t.previewEnd,t.highlight),t.ellipsesAfter&&S.appendChild(document.createTextNode(" ..."))}}var D=document.createElement("span");D.classList.add("search-result-rel-url"),D.innerText=a.relUrl,r.appendChild(D)}function p(e,t,n,a,s){var i=n;for(var r in s){let n=s[r],a=document.createElement("span");a.innerHTML=t.substring(i,n[0]),e.appendChild(a),i=n[0]+n[1];var o=document.createElement("span");o.classList.add("search-result-highlight"),o.innerHTML=t.substring(n[0],i),e.appendChild(o)}var d=document.createElement("span");d.innerHTML=t.substring(i,a),e.appendChild(d)}}c.addEvent(a,"focus",(function(){setTimeout(o,0)})),c.addEvent(a,"keyup",(function(e){switch(e.keyCode){case 27:a.value="";break;case 38:case 40:case 13:return void e.preventDefault()}o()})),c.addEvent(a,"keydown",(function(e){let t;switch(e.keyCode){case 38:if(e.preventDefault(),t=document.querySelector(".search-result.active"),t&&(t.classList.remove("active"),t.parentElement.previousSibling)){var n=t.parentElement.previousSibling.querySelector(".search-result");n.classList.add("active"),n.scrollIntoView({behavior:"smooth",block:"nearest"})}return;case 40:if(e.preventDefault(),t=document.querySelector(".search-result.active"),t){if(t.parentElement.nextSibling){var a=t.parentElement.nextSibling.querySelector(".search-result");t.classList.remove("active"),a.classList.add("active"),a.scrollIntoView({behavior:"smooth",block:"nearest"})}}else{let e=document.querySelector(".search-result");e&&e.classList.add("active")}return}})),c.addEvent(document,"click",(function(e){e.target!=a&&r()}))};static selectResult(){let e=document.querySelector(".search-result.active");if(e)e.click();else{var t=document.querySelector(".search-result");t&&t.click()}}static async init(){window.lunr.tokenizer.separator=/[\s\-/]+/,document.addEventListener("search-index-updated",(e=>{console.log("Search.init: reloading search index..."),c.jtdSearchLoaded(e.detail.index,e.detail.docs)}));try{const e=await d.d.getCache();if(e&&e.index&&e.docs){console.log("Load search index from cache...");let t=window.lunr.Index.load(JSON.parse(e.index));return void c.jtdSearchLoaded(t,e.docs)}}catch(e){console.error(`ERROR: Failed to load index from cache (${e})!`)}d.d.update()}}class l{#n;#a;setMode(e){this.#a.textContent=e,this.#a.dataset.mode=e,this.#n.placeholder=""}getMode(){return this.#a.dataset.mode}constructor(e){this.#a=document.querySelector(".search-input-wrap .mode"),this.#n=document.getElementById(e),this.#n.focus(),this.#n.addEventListener("input",(async()=>"!"==this.#n.value[0]?(this.setMode("Cmd"),void(this.#n.value=this.#n.value.slice(1))):"?"==this.#n.value[0]?(this.setMode("Chat"),void(this.#n.value=this.#n.value.slice(1))):void 0)),this.#n.addEventListener("keydown",(async e=>"Enter"===e.key||13===e.keyCode?(window.location.hash="/-/CLI","Cmd"===this.getMode()?l.#s(this.#n.value):"Chat"===this.getMode()?a.ChatView.submitPrompt(this.#n.value):c.selectResult(),this.#n.value="",void e.preventDefault()):"Escape"===e.key||27===e.keyCode?(this.#n.value.length>0?o.ContentView.hideSearch():this.setMode("Search"),void e.preventDefault()):void(this.#n.value.length>1&&"Search"===this.getMode()&&o.ContentView.showSearch()))),document.addEventListener("keydown",(function(e){e.ctrlKey&&75===e.keyCode&&(l.#i(),e.preventDefault())})),this.setMode("Search")}static#i=()=>document.getElementById("search-input").focus();static#s=async e=>{const[t,n]=await r.run(e);a.ChatView.addToolResult(e,n,t)}}class u{#r;constructor(){s.u.get("Split").then((e=>{this.#r=e(["#sidebar","#main","#toolpanel"],{sizes:[0,70,30],minSize:[300,300,0],maxSize:[300,1/0,1/0],gutterSize:1,expandToMin:!0,direction:"horizontal"}),window.addEventListener("resize",(()=>this.#o())),this.#o()}))}#o(){window.innerWidth>1200?(this.#r.setSizes([5,70,25]),document.getElementById("toolpanel").style.display="block",document.getElementById("sidebar").style.display="block"):window.innerWidth>640?(this.#r.setSizes([5,95,0]),this.#r.collapse(2),document.getElementById("toolpanel").style.display="none",document.getElementById("sidebar").style.display="block"):(this.#r.setSizes([0,100,0]),this.#r.collapse(1),this.#r.collapse(2),document.getElementById("toolpanel").style.display="none",document.getElementById("sidebar").style.display="none")}}var h=n(216),p=n(943),m=n(933),f=n(779);class g{#d;constructor(e,t,n){this.#d=t;const a=document.getElementById("modal"),s=(0,f.vs)(e);a.innerHTML=s(this.#d),a.showModal(),a.querySelectorAll("button").forEach((e=>{e.addEventListener("click",(e=>{this.#d={},[...a.querySelectorAll("input, select, textarea")].forEach((e=>this.#d[e.name]=e.value)),n(this.#d,e.target).then((e=>{e&&a.close(),a.innerHTML=s(this.#d)})),e.preventDefault()}))})),a.addEventListener("keydown",(e=>{"Escape"===e.code&&(a.close(),e.preventDefault())}))}setData(e){this.#d=e}}class w extends g{constructor(){super("\n            <h2>Help</h2>\n\n            <h3>Keyboard</h3>\n\n            <table>\n                <tr>\n                    <td>F1</td>\n                    <td>Help</td>\n                </tr>\n                <tr>\n                    <td>Ctrl - right arrow</td>\n                    <td>Next Unread</td>\n                </tr>\n                <tr>\n                    <td>Ctrl - Shift - M</td>\n                    <td>Mark All Read</td>\n                </tr>\n                <tr>\n                    <td>Ctrl - Shift - U</td>\n                    <td>Update All</td>\n                </tr>\n            </table>\n\n            <h3>Mouse</h3>\n\n            <table>\n                <tr>\n                    <td>Left Click</td>\n                    <td>Select feed or item / Open a link</td>\n                </tr>\n                <tr>\n                    <td>Middle Click</td>\n                    <td>Toggle Unread / Mark All Read</td>\n                </tr>\n                <tr>\n                    <td>Double Click</td>\n                    <td>Open item in browser</td>\n                </tr>\n            </table>\n        ",{},(async()=>!0))}}var v=n(470),y=n(624),b=n(890),x=n(218),E=n(182);class I extends E.S{constructor(e){super({root:e,template:"\n            {{#compare feed.type '==' 'feed'}}\n                <h1 id='itemViewContentTitle'>\n                    <a target='_system' href='{{feed.homepage}}'>{{feed.title}}</a>\n                </h1>\n\n                    <p>\n                        Source: <a target='_system' href='{{feed.source}}'>{{feed.source}}</a><br>\n                    </p>\n\n                    <div class='feedInfoError'>\n                    {{#if feed.error}}\n                        <div class='feedInfoErrorBox'>\n                            <span>There was a problem when fetching this subscription!</span>\n                            <ul>\n                                <li>\n                                    {{#compare feed.error '==' 1}}‚õî{{/compare}}\n                                    {{#compare feed.error '>'  1}}‚úÖ{{/compare}}\n                                    <span>1. Authentication</span>\n                                </li>\n                                <li>\n                                    {{#compare feed.error '==' 2}}‚õî{{/compare}}\n                                    {{#compare feed.error '>'  2}}‚úÖ{{/compare}}\n                                    {{#compare feed.error '<'  2}}‚¨ú{{/compare}}\n                                    <span>2. Download</span>\n                                </li>\n                                <li>\n                                    {{#compare feed.error '==' 4}}‚õî{{/compare}}\n                                    {{#compare feed.error '>'  4}}‚úÖ{{/compare}}\n                                    {{#compare feed.error '<'  4}}‚¨ú{{/compare}}\n                                    <span>3. Feed Discovery</span>\n                                </li>\n                                <li>\n                                    {{#compare feed.error '==' 8}}‚õî{{/compare}}\n                                    {{#compare feed.error '<'  8}}‚¨ú{{/compare}}\n                                    <span>4. Parsing</span>\n                                </li>\n                            </ul>    \n\n                            {{#unless feed.allowCorsProxy}}\n                                {{#compare feed.error '==' 2}}\n                                    <p>Downloads often do not work due to <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CORS\">CORS restrictions</a>.\n                                    You might want to use the Cloudflare CORS proxy (<a href=\"https://corsproxy.io\">corsproxy.io</a>) for this feed.</p>\n                                    <button class='btn' data-action='feedreader:allowCorsProxy' data-id='{{feed.id}}' data-global='false'>Use proxy for this feed</button>\n                                    <button class='btn' data-action='feedreader:allowCorsProxy' data-id='{{feed.id}}' data-global='true'>Use proxy for all feeds</button>\n                                {{/compare}}\n                            {{/unless}}\n                        {{/if}}\n                    </div>\n                </div>\n\n                <p>{{{feed.description}}}</p>\n\n                {{#if feed.feedStatusMsg}}\n                    <div class='feedInfoStatus'>\n                        <span>{{feed.feedStatusMsg}}</span>\n                    </div>\n                {{/if}}\n                Last updated: <span class='feedLastUpdated'>{{lastUpdated}}</span><br>\n                <button class='btn' data-action='feedreader:updateNode' data-id='{{feed.id}}'>Update Now</button>\n                {{/compare}}\n            ",updateEvents:["nodeUpdated","feedUpdating"],dataEvents:["feedSelected"],mapper:async e=>{const t=x.f.getNodeById(e.id);return t?{feed:t,lastUpdated:t.last_updated?new Date(1e3*t.last_updated).toLocaleString():"never"}:{}},postRender:()=>{L.getSelectedItemId()||(e.ownerDocument.getElementById("itemViewContent").style.display="none",e.ownerDocument.getElementById("feedViewContent").style.display="block")}})}}var C=n(136),k=n(217);class R extends E.S{static#c=(0,f.vs)("\n        <span class='date'>{{time}}</span>\n        <span class='title' data-read='{{read}}'>\n            {{#if starred}}<span class='star'>‚≠ê</span>{{/if}}\n            {{title}}\n        </span>\n    ");#l;constructor(e){super({root:e,template:"\n                <div class='newItems hidden'>Click to show new items</div>\n                <div>\n                {{#each items}}\n                        <div class='item context-node' data-id='{{id}}' data-feed='{{nodeId}}'></div>\n                {{/each}}\n                </div>\n            ",dataEvents:["feedSelected"],mapper:async e=>{const t=x.f.getNodeById(e.id);return t&&"feed"===t.type?(this.#l=await t.getItems(),console.log(`ItemList Loading items for node ${t.title}`,this.#l),{node:t,items:this.#l.sort(((e,t)=>t.time-e.time))}):{}},postRender:async()=>{this.#l?.forEach((e=>this.#u(e))),e.ownerDocument.getElementById("itemlistViewContent").scrollTop=0}}),document.addEventListener("itemUpdated",(e=>this.#u(e.detail))),document.addEventListener("itemSelected",(e=>this.#h(e.detail.id,e.detail.feedId))),document.addEventListener("itemsAdded",(e=>{e.detail.feedId==this.getData().id&&document.querySelector("#itemlistViewContent .newItems").classList.remove("hidden")})),v.Ng("click",".item",(e=>L.select(parseInt(e.dataset.feed),parseInt(e.dataset.id)))),v.Ng("auxclick",".item",(e=>k.r.dispatch("feedreader:toggleItemRead",{id:parseInt(e.dataset.id)},(e=>1==e.button)))),v.Ng("dblclick",".item",(e=>this.openItemLink(parseInt(e.dataset.id)))),v.Ng("click",".newItems",(()=>{document.querySelector(".newItems").classList.add("hidden"),L.select(this.displayedFeedId,void 0)})),document.addEventListener("keydown",(e=>{if("itemlist"!==document.activeElement.id)return;if("itemlist"===!e.target.id)return;const t=document.querySelector(".item.selected");"ArrowDown"===e.key&&(t?t.nextElementSibling?.click():document.querySelector(".item")?.click(),e.preventDefault()),"ArrowUp"===e.key&&(t?t.previousElementSibling?.click():document.querySelector(".item")?.click(),e.preventDefault()),"Enter"===e.key&&t&&(this.openItemLink(parseInt(t.dataset.id)),e.preventDefault())}))}openItemLink=async e=>window.open((await b.q.getById(e)).source,"_system","location=yes");async#h(e){const t=await b.q.getById(e);[...document.querySelectorAll(".item.selected")].forEach((e=>e.classList.remove("selected")));let n=document.querySelector(`.item[data-id="${e}"]`);n.classList.add("selected"),n.scrollIntoView({block:"nearest"}),document.getElementById("itemlist").focus(),console.log("ItemList Item selected:",t),this.selected=t,t.read||k.r.dispatch("feedreader:toggleItemRead",{id:e})}#u(e){let t=e.title;if(!t||0===t.trim().length)if(e.description&&e.description.length>0){const n=(new DOMParser).parseFromString(e.description,"text/html").body.textContent||"";t=n.substring(0,100)+(n.length>100?"...":"")}else t="No title";(0,f.XX)(`.item[data-id="${e.id}"]`,R.#c,{time:C.i.getShortDateStr(e.time),read:e.read,starred:e.starred,title:t})}}class S extends E.S{constructor(e){super({root:e,template:"\n                <h1 id='itemViewContentTitle'>\n                    {{#if item.title}}\n                        <a target='_system' href='{{item.source}}'>{{item.title}}</a>\n                    {{else}}\n                        <a target='_system' class='missingTitle' href='{{item.source}}'>Link to post</a>\n                    {{/if}}\n                </h1>\n\n                <span class='date'>{{time}}</span>\n                <div class='date'></div>\n\n                {{#each item.media}}\n                    {{#contains 'audio' mime }}\n                        <audio controls preload='none' src='{{ url }}'></audio>\n                    {{/contains}}\n                    {{#contains 'video' mime }}\n                        <video controls preload='none' src='{{ url }}'></video>\n                    {{/contains}}\n                {{/each}}\n\n                <p>{{{item.description}}}</p>\n            ",dataEvents:["itemSelected"],mapper:async e=>{const t=await b.q.getById(e.id);return{item:t,time:C.i.getShortDateStr(t.time)}},postRender:async t=>{const n=await b.q.getById(t.id);n.title&&n.media&&n.media.length>0&&(console.log("itemview media detected setting window.document.title"),window.document.title=window.Config.siteName+" | "+n.title),e.ownerDocument.getElementById("itemViewContent").scrollIntoView({block:"start"}),L.getSelectedItemId()&&(e.ownerDocument.getElementById("itemViewContent").style.display="block",e.ownerDocument.getElementById("feedViewContent").style.display="none")}})}}class D extends g{constructor(e){n(638)(window.Config.rssFinderUrl),super(`\n            {{#unless discover}}\n                <h2>Subscribe to Feed</h2>\n\n                <p>\n                    <div>\n                        <input type='hidden' name='parentId' value='{{parentId}}'/>\n                        <input type='text' name='url' width='100%' placeholder='URL'/>\n                        <button>Subscribe</button>\n                    </div>\n                    {{#if error}}\n                        <div>Error: {{error}}</div>\n                    {{/if}}\n                </p>\n\n                <p>Or discover feeds from the different sources...</p>\n\n                <button class="btn">Discover Feeds</button>\n            {{else}}\n                <h2>Discover Feeds</h2>\n\n                <x-rss-finder show-title="false" subscribe-method="event" icon-path="${window.Config.rssFinderUrl.replace("js/widget.js","icons")}" target="_self"></x-rss-finder>\n            {{/unless}}\n            `,{parentId:e},(async(e,t)=>"Discover Feeds"===t.innerText?(this.setData({parentId:e.parentId,discover:!0}),!1):(k.r.dispatch("feedreader:addFeed",{parentId:e.parentId,source:e.url,title:"New Subscription"}),!0)))}}class ${fresh=!1;static#p;static#m=new Map;constructor(e,t){$.#m.set(e,t),$.#p||($.#p=document.addEventListener("contextmenu",(e=>{let t=e.target;for(;t&&(!t.id||!$.#m.has(t.id));)t=t.parentElement;t&&t.id&&$.#m.has(t.id)&&(e.preventDefault(),this.createMenu(t,e,$.#m.get(t.id)))}))),document.addEventListener("click",(()=>this.checkRemove())),document.addEventListener("auxclick",(()=>this.checkRemove()))}checkRemove(){this.fresh?this.fresh=!1:document.querySelectorAll(".context-menu").forEach((e=>e.remove()))}createMenu(e,t,n){this.checkRemove(e);const a=t.target.closest(".context-node");a&&(this.fresh=!0,this.menu=document.createElement("div"),this.menu.className="context-menu",n.forEach((e=>{if(e.type&&a.dataset.type!==e.type)return;const t=document.createElement("div");t.className="context-menu-item",t.textContent=e.label,t.addEventListener("click",(()=>k.r.dispatch(e.action,a.dataset))),this.menu.appendChild(t)})),this.menu.style.setProperty("--mouse-x",t.pageX+"px"),this.menu.style.setProperty("--mouse-y",t.pageY+"px"),this.menu.style.display="block",e.appendChild(this.menu))}hide(){this.menu.style.display="none"}}class L{static#f="#/-/Feed/";static#g;static#w;static#v;static feedinfo;static itemview;static itemlist;static async setup(e){this.#g=e,this.#g.innerHTML='\n            <div id="itemlist" tabindex="1">\n                <div id="itemlistViewContent"></div>\n            </div>\n            <div id="itemview" tabindex="2">\n                <div id="itemViewContent" style="display: none"></div>\n                <div id="feedViewContent"></div>\n            </div>',s.u.get("Split").then((e=>{e(["#itemlist","#itemview"],{sizes:[30,70],minSize:[100,100],gutterSize:3,expandToMin:!0,direction:"vertical"})})),this.feedinfo=new I(this.#g.ownerDocument.getElementById("feedViewContent")),this.itemview=new S(this.#g.ownerDocument.getElementById("itemViewContent")),this.itemlist=new R(this.#g.ownerDocument.getElementById("itemlistViewContent")),this.feedinfo.setData({id:this.#w}),this.itemview.setData({id:this.#v}),this.itemlist.setData({id:this.#w})}static async initialize(){await x.f.setup(),i.w.addSchema({"feedreader:::refreshInterval":{default:24,description:"The default refresh interval for the feed reader"},"feedreader:::refreshIntervalUnit":{default:"hours",description:"The default refresh interval unit for the feed reader"},"feedreader:::maxItems":{default:100,description:"The maximum number of items to display in the feed reader"},allowCorsProxy:{default:!1,description:"Allow using a CORS proxy for feed + content requests"}}),new $("sidebar",[{label:"Update",action:"feedreader:updateNode",type:"feed"},{label:"Mark Read",action:"feedreader:markRead",type:"feed"},{label:"Remove",action:"feedreader:removeNode",type:"feed"},{label:"Update All",action:"feedreader:updateNode",type:"folder"},{label:"Add Feed",action:"aggregator:addFeed",type:"folder"},{label:"Add Folder",action:"aggregator:addFolder",type:"folder"},{label:"Mark All Read",action:"feedreader:markRead",type:"folder"},{label:"Remove",action:"feedreader:removeNode",type:"folder"}]),new $("itemlist",[{label:"Open Link",action:"feedreader:openItemLink"},{label:"Toggle Read",action:"feedreader:toggleItemRead"},{label:"Toggle Star",action:"feedreader:toggleItemStar"}]),k.r.register("aggregator:addFolder",(()=>x.f.addNewFolder({parentId:L.getSelectedNodeId()}))),k.r.register("aggregator:addFeed",(()=>new D(this.getSelectedNodeId))),k.r.register("feedreader:addFeed",(e=>x.f.add(new y.J({source:e.source,title:e.title,parent:x.f.getNodeById(parseInt(e.parentId))})))),k.r.register("feedreader:markRead",(e=>x.f.markAllRead(parseInt(e.id)))),k.r.register("feedreader:updateNode",(e=>x.f.updateNode(x.f.getNodeById(e.id),!0))),k.r.register("feedreader:removeNode",(e=>x.f.remove(parseInt(e.id)))),k.r.register("feedreader:allowCorsProxy",(e=>{const t=x.f.getNodeById(e.id);"true"===e.global?i.w.set("allowCorsProxy",!0):x.f.allowCorsProxy(t.id,!0),t.update()})),k.r.register("sidebar:feed:middleClick",(e=>x.f.markAllRead(parseInt(e.id)))),k.r.register("feedreader:nextUnread",(()=>this.nextUnread(this.#w,this.#v))),k.r.register("feedreader:select",(e=>this.select(e.itemId,e.nodeId))),k.r.register("feedreader:toggleItemRead",(async e=>{const t=await b.q.getById(parseInt(e.id)),n=x.f.getNodeById(t.nodeId);t.setRead(!t.read),n.updateUnread(t.read?-1:1)})),k.r.register("feedreader:toggleItemStar",(async e=>{const t=await b.q.getById(parseInt(e.id));t.setStarred(!t.starred)})),k.r.register("feedreader:openItemLink",(e=>this.itemlist.openItemLink(parseInt(e.id)))),k.r.hotkey("C-A-KeyR","feedreader:markRead",this.#f,(()=>({id:this.#w}))),k.r.hotkey("C-A-KeyU","feedreader:updateNode",this.#f,(()=>({id:this.#w}))),k.r.hotkey("C-ArrowRight","feedreader:nextUnread",this.#f),window.addEventListener("hashchange",(()=>this.#y())),this.#y()}static#y(){const e=this.#w,t=this.#v;if(!window.location.hash.startsWith(this.#f))return;console.log("feedreader onLocationChange",window.location.hash);const n=window.location.hash.match(/Feed\/(?<feedId>\d+)(\/Item\/(?<itemId>\d+))?/);this.#w=n.groups.feedId?parseInt(n.groups.feedId):null,this.#v=n.groups.itemId?parseInt(n.groups.itemId):null,e==this.#w&&t==this.#v||(console.log("feedreader selection needs to be changed: item",this.#v,"feed",this.#w),this.#v?v.JD("itemSelected",{feedId:this.#w,id:this.#v}):v.JD("feedSelected",{id:this.#w}))}static select(e,t=void 0){window.location.hash=`${this.#f}${e}${t?`/Item/${t}`:""}`}static selectItem(e){window.location.hash=`${this.#f}${this.#w}/Item/${e}`}static getSelectedItemId=()=>this.#v;static getSelectedNodeId=()=>this.#w;static async nextUnread(){let e,t,n;this.#w?(t=x.f.getNodeById(this.#w),n=this.#v):(t=x.f.getNextUnreadNode(0),n=0),console.log("itemlist nextUnread: starting at node id",t.id,"item id",n),t&&(e=await t.getNextUnread(n),e||(t=x.f.getNextUnreadNode(t.id),e=await t.getNextUnread(n)),console.log("itemlist nextUnread: result",e),e&&L.select(t.id,e.id))}}L.initialize();const N=window.fetch.bind(window);window.fetch=async function(e,t={}){const n=new AbortController,a=setTimeout((()=>n.abort()),3e4);t.signal=n.signal;try{let n,a=t.allowCorsProxy;try{n=await N(e,t)}catch(s){if(a||(a=await i.w.get("allowCorsProxy",!1)),!a)return null;n=await N(window.Config.corsProxy+encodeURI(e),t)}return n}catch(e){console.error("Fetch error:",e)}finally{clearTimeout(a)}};class O{static#b(){let e={};try{let t,n=/\+/g,a=/([^&=]+)=?([^&]*)/g,s=function(e){return decodeURIComponent(e.replace(n," "))};for(;t=a.exec(window.location.hash.substring(1));)e[s(t[1])]=s(t[2])}catch(e){console.log("Invalid parameter encoding! "+e)}return e}static#x(){if(window.location.hash.length>2){if("/"!=window.location.hash[1])return;if("/"==window.location.hash.substring(1,2)){const e=O.getPath();return O.#E(e),void o.ContentView.render(e)}console.warn("Unknown location hash format: "+window.location.hash)}else O.#E("")}static getPath=()=>Object.keys(O.#b())[0].substring(1);static#I=e=>document.getElementById("breadcrumb-nav").innerHTML=""===e?"":'<li class="breadcrumb-nav-list-item"><a href="/"><svg viewBox="0 0 24 24"><use xlink:href="#svg-home"></use></svg></a></li>'+e.split(/\//).reverse().map(((t,n,a)=>"-"===t?"":0==n?`<li class="breadcrumb-nav-list-item"><span>${decodeURIComponent(t)}</span></li>`:`<li class="breadcrumb-nav-list-item"><a href="#/${e.split(/\//).slice(0,a.length-n).join("/")}">${decodeURIComponent(t)}</a></li>`)).reverse().join(" ");static#E(e){this.#I(e),h.Sidebar.selectionChanged(e)}static async load(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/worker.js").then((e=>{console.log("ServiceWorker registration successful with scope: ",e.scope)})).catch((e=>{console.error("ServiceWorker registration failed: ",e)})),window.app={ChecksView:new p.ChecksView(document.getElementById("toolpanel")),CLI:new l("search-input"),Commands:r,ContentView:new o.ContentView(document.getElementById("main-content-wrap")),debug:{all:!1,feedreader:!1,feedlist:!1,feedupdater:!1,itemlist:!1,events:!1,View:!1},FeedReader:L,Layout:new u,Sidebar:new h.Sidebar(document.getElementById("site-nav"))},await m.m.update(),window.addEventListener("hashchange",this.#x),this.#x(),c.init(),(0,v.qm)("body",(e=>112===e.keyCode),(()=>new w))}}O.load()},624:(e,t,n)=>{"use strict";n.d(t,{J:()=>u});var a=n(648),s=n(800),i=n(449);class r{static searches=[{type:"MS Tile",order:2,xpath:"/html/head/meta[@name='msapplication-TileImage']/@href"},{type:"Safari Mask",order:3,xpath:"/html/head/link[@rel='mask-icon']/@href"},{type:"large icon",order:0,xpath:"/html/head/link[@rel='icon' or @rel='shortcut icon'][@sizes='192x192' or @sizes='144x144' or @sizes='128x128']/@href"},{type:"small icon",order:5,xpath:"/html/head/link[@rel='icon' or @rel='shortcut icon'][@sizes]/@href"},{type:"favicon",order:8,xpath:"/html/head/link[@rel='icon' or @rel='shortcut icon' or @rel='SHORTCUT ICON'][not(@sizes)]/@href"},{type:"Apple touch",order:1,xpath:"/html/head/link[@rel='apple-touch-icon' or @rel='apple-touch-icon-precomposed'][@sizes='180x180' or @sizes='152x152' or @sizes='144x144' or @sizes='120x120']/@href"},{type:"Apple no size",order:6,xpath:"/html/head/link[@rel='apple-touch-icon' or @rel='apple-touch-icon-precomposed'][not(@sizes)]/@href"},{type:"Apple small",order:7,xpath:"/html/head/link[@rel='apple-touch-icon' or @rel='apple-touch-icon-precomposed'][@sizes]/@href"}].sort(((e,t)=>e.order-t.order));static fuzzyExtraction=[{type:"MS Tile",order:2,matchRegex:/<meta\s+name=.msapplication-TileImage.\s+[^>]+>/},{type:"Safari Mask",order:3,matchRegex:/<link\s+rel=.mask-icon.\s+[^>]+>/},{type:"large icon",order:0,matchRegex:/<link\s+rel=.icon.\s+[^>]+sizes=['"](192x192|144x144|128x128)['"]\s+[^>]+>/},{type:"small icon",order:5,matchRegex:/<link\s+rel=.icon.\s+[^>]+sizes=[^>]+>/},{type:"favicon",order:8,matchRegex:/<link\s+rel=.icon.\s+[^>]+>/},{type:"Apple touch",order:1,matchRegex:/<link\s+rel=.apple-touch-icon.\s+[^>]+sizes=['"](180x180|152x152|144x144|120x120)['"]>/},{type:"Apple no size",order:6,matchRegex:/<link\s+rel=.apple-touch-icon.\s+[^>]+>/},{type:"Apple small",order:7,matchRegex:/<link\s+rel=.apple-touch-icon.\s+[^>]+sizes=[^>]+>/}].sort(((e,t)=>e.order-t.order));static hrefExtractRegex=new RegExp("href=['\"]([^'\"]+)['\"]");static async discover(e,t=!1){let n,a;console.log(`favicon discovery for ${e}`);try{let s=await window.fetch(e,{allowCorsProxy:t}).then((e=>e.text())).then((e=>(n=e,console.log("favicon discovery got HTML ",n),(new DOMParser).parseFromString(n,"text/html"))));if(s){console.log("favicon discovery HTML parse success");let e=s.firstChild;for(;e&&"HTML"!==e.nodeName.toUpperCase();)e=e.nextSibling;if(e){console.log("favicon discovery root element found");for(let t=0;t<r.searches.length&&(a=i.u.lookup(e,r.searches[t].xpath),!a);t++);}}}catch(e){console.log("favicon discovery via XPath failed",e)}if(!a&&n){console.log("favicon discovery via regex fuzzy matches");for(let e=0;e<r.fuzzyExtraction.length;e++){console.log("favicon discovery test for",r.fuzzyExtraction[e].type);let t=r.fuzzyExtraction[e].matchRegex.exec(n);if(t){console.log("favicon discovery match for ",t[0]),t=r.hrefExtractRegex.exec(t[0]),a=t?t[1]:null;break}}}if(a||(a=await fetch(e+"/favicon.ico",{allowCorsProxy:t}).then((e=>e.text())).then((()=>e+"/favicon.ico"))),a)return console.log(`favicon discovery found '${a}'`),a.includes("://")?a:a.startsWith("/")?e+a:e+"/"+a;console.log("favicon discovery nothing found")}}class o{static async fetch(e,t=!1){console.log(`feedupdater updating ${e}`);let n=await fetch(e,{allowCorsProxy:t}).then((async e=>(console.log("feedupdater headers",e.headers),await e.text()))).then((async n=>{let a=(0,s.S)(n,e);if(!a)return console.log(`feedupdater No suitable parser found for ${e}`),new u({error:u.ERROR_DISCOVER});console.log("feedupdater using parser",a);let i=a.parse(n);if(!i)return console.log(`feedupdater Failed to parse feed from ${e}`),new u({error:u.ERROR_XML});if(i.source=e,i.last_updated=Date.now()/1e3,i.error=u.ERROR_NONE,!i.icon&&i.homepage)try{console.log("feedupdater no icon in feed, starting favicon autodiscovery"),i.icon=await r.discover(i.homepage,t)}catch(e){}return i})).catch((t=>(console.log(`feedupdater Failed to download feed from ${e}`,t),new u({error:u.ERROR_NET}))));return console.log("feedupdater result",n),n}}var d=n(890),c=n(470),l=n(551);class u{id;error;orig_source;last_updated=0;last_updated_favicon=0;allowCorsProxy=!1;newItems=[];unreadCount=0;title;source;description;icon;iconData;metadata={};type="feed";feedStatusMsg;static ERROR_NONE=0;static ERROR_AUTH=1;static ERROR_NET=2;static ERROR_DISCOVER=4;static ERROR_XML=8;constructor(e={}){Object.keys(e).forEach((t=>{this[t]=e[t]})),this.orig_source||(this.orig_source=this.source)}serialize(){return{id:this.id,title:this.title,description:this.description,homepage:this.homepage,icon:this.icon,iconData:this.iconData,source:this.source,orig_source:this.orig_source,last_updated:this.last_updated,last_updated_favicon:this.last_updated_favicon,allowCorsProxy:this.allowCorsProxy,unreadCount:this.unreadCount,metadata:this.metadata,type:this.type}}#C(e){console.log(`Feed status update(${this.source}): ${e}`),this.feedStatusMsg=e,c.JD("feedUpdating",{id:this.id})}async update(e=!1){let t=await l.w.get("feedreader:::refreshInterval");const n=await l.w.get("feedreader:::refreshIntervalUnit");if(console.log(`Feed update(${this.source}, force=${e}) with interval ${t} ${n}`),"hours"===n)t*=3600;else{if("days"!==n)return void console.error(`Unknown update interval unit: ${n}`);t*=86400}if(e&&(this.#C(`Forcing update of ${this.source}`),this.last_updated=0,this.last_updated_favicon=0),this.last_updated&&Date.now()/1e3-this.last_updated<t)return void console.log(`Feed Skipping update of ${this.source} (last updated ${Math.ceil(Date.now()/1e3-this.last_updated)}s ago)`);let a=await o.fetch(this.source,this.allowCorsProxy);if(u.ERROR_DISCOVER==a.error){console.log(`Feed trying autodiscovery for original source ${this.orig_source}`);const e=await fetch(this.orig_source).then((e=>e.text())),t=(0,s.Z)(e,this.orig_source);if(!(t.length>0))return void this.#C("Feed update failed: Source is not a feed");console.log(`Feed changing source to ${t[0]}`),this.source=t[0],a=await o.fetch(this.source,this.allowCorsProxy)}if(u.ERROR_NONE==a.error){let e=0;this.title=a.title,this.source=a.source,this.homepage=a.homepage,this.description=a.description,this.metadata=a.metadata,this.icon=a.icon,this.iconData=a.iconData;const n=await this.getItems();if(this.unreadCount=n.filter((e=>!e.read)).length,a.newItems.forEach((t=>{n.find((e=>e.sourceId?e.sourceId===t.sourceId:e.source?e.source===t.source:e.title===t.title))||(e++,this.unreadCount++,t.nodeId=this.id,t.save())})),e>0&&c.JD("itemsAdded",this),Date.now()/1e3-this.last_updated_favicon>30*t){this.#C(`Updating favicon for ${this.source} (${this.icon})`);const e=await fetch(this.icon);if(e.ok){const t=await e.blob(),n=await new Promise(((e,n)=>{try{const n=new FileReader;n.onload=function(){e(this.result)},n.readAsDataURL(t)}catch(e){n(e)}}));n&&n.startsWith("data:image")?(this.iconData=n,console.log(`Favicon update for ${this.source} (${this.icon}) was successful`)):console.warn(`Favicon update for feed ${this.id} failed`),this.last_updated_favicon=Date.now()/1e3}else console.warn(`Favicon response for feed ${this.id} failed`)}else console.warn(`Favicon fetch for feed ${this.id} failed`);this.#C(void 0)}else this.#C(`Feed update failed: ${a.error}`);this.last_updated=a.last_updated,this.error=a.error,c.JD("nodeUpdated",this)}getItems=async()=>(await a.DB.getByIndexOnly("aggregator","items","nodeId",this.id)).map((e=>new d.q({id:e.id,...e.value})));async getNextUnread(e){let t,n=0;if(!e)return;const a=await this.getItems();return a.find((t=>(n++,t.id===e))),t=a.slice(n).find((e=>!e.read)),console.log("feed getNextUnread find forward result:",t),t||(t=a.find((e=>!e.read)),console.log("feed getNextUnread find from start result:",t),t)}addItem(e){e.time||(e.time=Date.now()),this.newItems.push(e)}updateUnread(e){this.unreadCount+=e,this.unreadCount<0&&(this.unreadCount=0),this.parent.updateUnread&&this.parent.updateUnread(e),c.JD("nodeUpdated",this)}async markAllRead(){(await this.getItems()).forEach((e=>e.setRead(!0))),this.updateUnread(-this.unreadCount)}}},218:(e,t,n)=>{"use strict";n.d(t,{f:()=>d});var a=n(624),s=n(470);class i{id;title;type="folder";unreadCount=0;constructor(e={}){Object.keys(e).forEach((t=>{this[t]=e[t]}))}serialize(){return{id:this.id,title:this.title,type:this.type}}updateUnread(e){this.unreadCount+=e,this.unreadCount<0&&(this.unreadCount=0),console.log("folder updateUnread",this),this.parent.updateUnreadCount&&this.parent.updateUnreadCount(e),s.JD("nodeUpdated",this)}}var r=n(648),o=n(551);class d{static root={children:[],unreadCount:0};static#k={};static maxId=1;static getNodeById=e=>e?d.#k[parseInt(e)]:void 0;static getNextUnreadNode(e){let t,n=0;return e&&(this.root.children.find((t=>(n++,t.id===e))),t=this.root.children.slice(n).find((e=>e.unreadCount>0)),t)?t:this.root.children.find((e=>e.unreadCount>0))}static#R(){console.log("feedlist save"),r.DB.set("aggregator","tree","tree",d.root.children.map((function e(t){const n=t.serialize();return t.children&&(n.children=t.children.map(e)),n})))}static allowCorsProxy(e,t){d.#k[e].allowCorsProxy=t,d.#R()}static addNewFolder(e){const t=prompt("New folder title:");if(t){let n=d.getNodeById(e);n&&n.children||(n=d.root);const a=new i({id:++d.maxId,title:t,children:[]});n.children.push(a),d.#k[a.id]=a,d.#R(),s.JD("nodeUpdated",a),console.log(`feedlist Added new folder: ${t}`,n,d.root)}}static async add(e,t=!0){e.id||(e.id=d.maxId+1),e.id>d.maxId&&(d.maxId=e.id),d.#k[e.id]=e,e.parent||(e.parent=d.root),e.parent.children.push(e),t&&await e.update(),d.#R()}static remove(e){console.log("feedlist remove("+e+")");let t=d.getNodeById(e);t&&(t.parent.children=t.parent.children.filter((t=>t.id!==e)),delete d.#k[e],d.#R(),s.JD("nodeRemoved",e))}static markAllRead(e){let t=d.getNodeById(e);t.children&&t.children.forEach((e=>this.markAllRead(e.id))),t.markAllRead()}static#S(e,t){for(const n of e){const e=parseInt(n.id);if(d.maxId<e&&(d.maxId=e),"folder"===n.type){const a=new i(n);a.parent=t,a.children=[],d.#k[e]=a,t.children.push(a),console.log("Add folder",n),this.#S(n.children,a)}if("feed"===n.type||!n.type){const s=new a.J(n);s.parent=t,d.#k[e]=s,t.children.push(s),t.unreadCount+=s.unreadCount,console.log("Add feed",n)}}}static async setup(){console.log("feedlist setup");const e=await r.DB.get("aggregator","tree","tree",window.Config.groups.Feeds.defaultFeeds);this.#S(e,d.root),document.dispatchEvent(new CustomEvent("sections-updated")),document.addEventListener("nodeUpdated",(()=>d.#R())),d.root.children.length>0&&d.#R(),o.w.get("feedreader:::updateAllOnStartup")&&d.update(),d.#k.length>0&&r.DB.removeOrphans("aggregator","items","nodeId",Object.keys(d.#k).map((e=>parseInt(e)))),console.log("feedlist setup done")}static updateNode(e,t=!1){e.children?e.children.forEach((e=>{this.updateNode(e,t)})):"Feed"===e.constructor.name&&e.update(t)}static update(){this.updateNode(this.root)}}},890:(e,t,n)=>{"use strict";n.d(t,{q:()=>i});var a=n(648),s=n(470);class i{id=void 0;nodeId=0;read=!1;starred=!1;title;description;time;source;sourceId;media=[];metadata={};constructor(e){Object.keys(e).forEach((t=>{this[t]=e[t]}))}addMedia(e,t,n=NaN){let a=NaN;try{a=parseInt(n,10)}catch{}e&&t&&-1===e.indexOf("www.gravatar.com")&&(this.description&&-1!==this.description.indexOf(e)||this.media.push({url:e,mime:t,length:a}))}setRead(e){this.read!==e&&(this.read=e,this.save(),s.JD("itemUpdated",this))}setStarred(e){this.starred!==e&&(this.starred=e,this.save(),s.JD("itemUpdated",this))}static getById=async e=>new i(await a.DB.getById("aggregator","items",e));async save(){this.nodeId||console.error("item.save(): nodeId is not set!",this);const e=await a.DB.set("aggregator","items",this.id,{nodeId:this.nodeId,read:this.read,starred:this.starred,title:this.title,description:this.description,time:this.time,source:this.source,sourceId:this.sourceId,media:this.media,metadata:this.metadata});this.id||(this.id=e)}}},800:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p,S:()=>h});var a=n(449),s=n(136);class i{static getRootNode(e){let t=e.firstChild;for(;1!=t.nodeType;)t=t.nextSibling;return t}static getNamespaces(e){const t=[];if(!e.attributes)return console.debug("No attributes!",e),t;for(let n=0;n<e.attributes.length;n++){const a=e.attributes[n];a.name.startsWith("xmlns:")&&t.push(a.name.substring(6))}return t}static parseFeed(e,t,n){const s=a.u.lookupNode(e,t);if(!s)return;const i=[];for(let t=0;t<e.attributes.length;t++){const n=e.attributes[t];n.name.startsWith("xmlns:")&&i.push(n.name.substring(6))}i.includes("webfeeds")&&(n.icon||(n.icon=a.u.lookup(s,"webfeeds:icon")))}static parseItem(e,t,n){const i=[];for(let t=0;t<e.attributes.length;t++){const n=e.attributes[t];n.name.startsWith("xmlns:")&&i.push(n.name.substring(6))}if(i.includes("dc")&&(n.description||(n.description=a.u.lookup(t,"dc:description")),n.time||(n.time=s.i.parse(a.u.lookup(t,"dc:date")))),i.includes("content")){const e=a.u.lookupNode(t,"content:encoded");if(e)try{const t=(new DOMParser).parseFromString(`<a>${e.innerHTML}</a>`,"text/xml");n.description=t.documentElement.textContent}catch(e){console.log(`Failed to parse <content:encoded> (${e})!`)}}i.includes("media")&&a.u.foreach(t,"media:content",(e=>{n.addMedia(a.u.lookup(e,"@url"),a.u.lookup(e,"@type")||a.u.lookup(e,"@medium"),a.u.lookup(e,"@duration"))}))}}var r=n(624),o=n(890);class d{static id="atom";static autoDiscover=["/ns:feed/ns:entry"];static parseEntryLink(e,t){let n=a.u.lookup(e,"@href"),s=a.u.lookup(e,"@type"),i=a.u.lookup(e,"@rel");if(n){if("alternate_or_text/html"!==t.sourceType&&(i&&"alternate"===i||self&&"text/html"===s))return t.sourceType="alternate_or_text/html",void(t.source=n);t.source||(t.source=n)}}static parseEntry(e,t){let n=new o.q({title:a.u.lookup(e,"ns:title"),description:a.u.lookup(e,"ns:summary"),sourceId:a.u.lookup(e,"ns:id"),time:s.i.parse(a.u.lookup(e,"ns:updated"))});i.parseItem(t.root,e,n),a.u.foreach(e,"ns:link",d.parseEntryLink,n),t.feed.addItem(n)}static parse(e){const t=(new DOMParser).parseFromString(e,"application/xml"),n=i.getRootNode(t);let s=new r.J({error:a.u.lookup(n,"/parsererror"),title:a.u.lookup(n,"/ns:feed/ns:title"),icon:a.u.lookup(n,"/ns:feed/ns:icon"),description:a.u.lookup(n,"/ns:feed/ns:summary"),homepage:a.u.lookup(n,"/ns:feed/ns:link[@rel='alternate']/@href")||a.u.lookup(n,"/ns:feed/ns:link/@href")});return i.parseFeed(n,"/ns:feed",s),a.u.foreach(n,"/ns:feed/ns:entry",this.parseEntry,{root:n,feed:s}),s}}class c{static id="rss";static autoDiscover=["/rss/channel","/Channel/items"];static parseItem(e,t){let n=new o.q({title:a.u.lookup(e,"title"),description:a.u.lookup(e,"description"),source:a.u.lookup(e,"link"),sourceId:a.u.lookup(e,"guid"),time:s.i.parse(a.u.lookup(e,"pubDate"))});a.u.foreach(e,"enclosure",(e=>n.addMedia(a.u.lookup(e,"@url"),a.u.lookup(e,"@type")))),i.parseItem(t.root,e,n),t.feed.addItem(n)}static parse(e){const t=(new DOMParser).parseFromString(e,"application/xml"),n=i.getRootNode(t);let s=new r.J({error:a.u.lookup(n,"/parsererror")});return"Channel"===t.firstChild.nodeName&&(s.title=a.u.lookup(n,"/Channel/title"),s.description=a.u.lookup(n,"/Channel/description"),s.homepage=a.u.lookup(n,"/Channel/link"),i.parseFeed(n,"/Channel",s),a.u.foreach(n,"/Channel/items/item",this.parseItem,{root:n,feed:s})),"rss"===t.firstChild.nodeName&&(s.title=a.u.lookup(n,"/rss/channel/title"),s.description=a.u.lookup(n,"/rss/channel/description"),s.homepage=a.u.lookup(n,"/rss/channel/link"),i.parseFeed(n,"/rss/channel",s),a.u.foreach(n,"/rss/channel/item",this.parseItem,{root:n,feed:s})),s}}class l{static id="rdf";static autoDiscover=["/rdf:RDF/ns:channel"];static parseItem(e,t){let n=new o.q({title:a.u.lookup(e,"ns:title"),description:a.u.lookup(e,"ns:description"),source:a.u.lookup(e,"ns:link")});i.parseItem(t.root,e,n),t.feed.addItem(n)}static parse(e){const t=(new DOMParser).parseFromString(e,"application/xml"),n=i.getRootNode(t);let s=new r.J({error:a.u.lookup(n,"/parsererror")});return"rdf:RDF"===t.firstChild.nodeName&&(s.title=a.u.lookup(n,"/rdf:RDF/ns:channel/ns:title"),s.description=a.u.lookup(n,"/rdf:RDF/ns:channel/ns:description"),s.homepage=a.u.lookup(n,"/rdf:RDF/ns:channel/ns:link"),i.parseFeed(n,"/rdf:RDF/ns:channel",s),a.u.foreach(n,"/rdf:RDF/ns:item",this.parseItem,{root:n,feed:s})),s}}class u{static id="json";static parseItem(e){let t=new o.q({title:e.title,description:e.content_html||e.content_text||e.summary,time:s.i.parse(e.updated||e.date_published),sourceId:e.id,source:e.url||e.external_url});e.attachments&&Array.isArray(e.attachments)&&e.attachments.forEach((e=>t.addMedia(e.url,e.mime_type))),this.addItem(t)}static parse(e){const t=JSON.parse(e);let n=new r.J({type:this.id,title:t.title,icon:t.icon||t.favicon,description:t.description,homepage:t.home_page_url||t.feed_url});return t.items&&Array.isArray(t.items)&&t.items.forEach(this.parseItem,n),n}}function h(e,t=""){if(0==e.indexOf("{"))try{const t=JSON.parse(e);if(t.version&&t.version.startsWith("https://jsonfeed.org/version/"))return u}catch(e){}let n=[d,c,l];const s=(new DOMParser).parseFromString(e,"application/xml");console.log(`autodiscover ${t}`);for(let e=0;e<n.length;e++)for(let t=0;t<n[e].autoDiscover.length;t++)try{if(a.u.lookup(s.firstChild,n[e].autoDiscover[t]))return n[e]}catch(e){}}function p(e,t){let n;try{n=(new DOMParser).parseFromString(e,"text/html")}catch{console.info("autodiscover could not parse HTML!")}if(!n)return[];let a=[];if(n.head.querySelectorAll('link[rel="alternate"]').forEach((e=>{const t=e.getAttribute("type");t&&("application/atom+xml"!==t&&"application/rss+xml"!==t&&"application/rdf+xml"!==t&&"application/json"!==t&&"text/xml"!==t||a.push(e.getAttribute("href")))})),0===a.length){const t=/<link[^>]*>/g,n=/href="([^"]*)"/,s=/rel=["']alternate["']/,i=/type=["']([^"']+)["']/;let r;for(;null!==(r=t.exec(e));){const e=s.exec(r[0]),t=n.exec(r[0]),o=i.exec(r[0]),d=o?o[1]:null,c=t?t[1]:null;c&&d&&e&&("application/atom+xml"!==d&&"application/rss+xml"!==d&&"application/rdf+xml"!==d&&"application/json"!==d&&"text/xml"!==d||a.push(c))}}return a=a.map((e=>{if(e.includes("://"))return e;var n=new URL(t);return e.startsWith("/")?n.pathname=e:n.pathname+="/"+e,n.href})),a}},136:(e,t,n)=>{"use strict";n.d(t,{i:()=>a});class a{static parse(e){if(e)return new Date(e)?.getTime()/1e3}static getShortDateStr(e){if(!e)return"";const t=new Date(1e3*e),n=new Date,a=n.getTime()-t.getTime(),s=864e5,i=356*s;return a<s?`Today ${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:a<2*s?`Yesterday ${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:a<i&&t.getFullYear()===n.getFullYear()?t.toLocaleDateString([],{month:"short",day:"numeric"}):t.toLocaleDateString([],{year:"numeric",month:"short",day:"numeric"})}}},449:(e,t,n)=>{"use strict";n.d(t,{u:()=>a});class a{static evaluate(e,t){Object.getOwnPropertyDescriptor(globalThis,"window")?.get?.toString().includes("[native code]")||(t=t.replaceAll("ns:",""));let n=function(t){let n=t.ownerDocument.createNSResolver(t),a=(new window.DOMParser).parseFromString(e.outerHTML,"text/xml").children[0].getAttribute("xmlns");return function(e){return n.lookupNamespaceURI(e)||a}}(e);return e.ownerDocument.evaluate(t,e,n,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null)}static lookupNode(e,t){return a.evaluate(e,t).iterateNext()}static lookup(e,t){const n=a.lookupNode(e,t);return n?n.textContent:void 0}static foreach(e,t,n,s=null){const i=a.evaluate(e,t);let r=i.iterateNext();for(;r;)n(r,s),r=i.iterateNext()}}},217:(e,t,n)=>{"use strict";n.d(t,{r:()=>a});class a{static handlers={};static listener;static register(e,t){this.handlers[e]=t,this.listener||(this.listener=!0,document.addEventListener("click",(e=>{const t=e.target;t&&t.dataset.action&&(a.dispatch(t.dataset.action,t.dataset),e.preventDefault())})))}static hotkey(e,t,n="/",s=void 0){const i=e.split("-"),r=i.pop(),o=i.includes("A"),d=i.includes("C"),c=i.includes("S");document.addEventListener("keydown",(e=>{if(window.location.hash.startsWith(n)&&e.ctrlKey===d&&e.altKey===o&&e.shiftKey===c&&e.code===r){e.preventDefault();let n={};s&&(n=s()),a.dispatch(t,n)}}))}static dispatch(e,...t){if(this.handlers[e])return console.log("Action dispatched",{name:e,args:t}),this.handlers[e](...t);console.warn(`Action No handler for action "${e}"`)}}},182:(e,t,n)=>{"use strict";n.d(t,{S:()=>a});class a{#D;#d;#$;#L;#N;constructor(e){this.#D=window.Handlebars.compile(e.template),this.#d=e.data||{},this.#$=e.mapper,this.#N=e.postRender,this.#L=document.createElement("div"),this.#L.className="event-container",e.root.appendChild(this.#L),this.setData(this.#d),e.updateEvents?.forEach((e=>{console.log(`View binding to update event ${e}`),this.#L.ownerDocument.addEventListener(e,(t=>{for(const e in this.#d)if(t.detail[e]+""!=this.#d[e]+"")return;console.log(`View update event ${e} received`,t.detail),this.#O()}))})),e.dataEvents?.forEach((e=>{console.log(`View binding to data event ${e}`),this.#L.ownerDocument.addEventListener(e,(e=>{this.setData(e.detail)}))}))}async#O(){const e=this.#$?await this.#$(this.#d):this.#d,t=this.#D(e,this.#d);this.#L.innerHTML!==t&&(this.#L.innerHTML=t),this.#N&&this.#N(this.#d)}setData(e){this.#d={...this.#d,...e},console.log("View new data received",this.#d);for(const e in this.#d)this.#L.dataset[e]=this.#d[e];this.#O()}getData=()=>this.#d}},470:(e,t,n)=>{"use strict";function a(e,t,n,a=void 0){document.addEventListener(e,(function(e){if(a&&!a(e))return;let s=e.target.closest(t);s&&(n(s),e.preventDefault())}))}function s(e,t,n){document.querySelector(e).addEventListener("keydown",(e=>{if(t(e))return n(e),e.preventDefault(),!1}))}function i(e,t){console.log("events dispatch",e,t),document.dispatchEvent(new CustomEvent(e,{detail:t}))}n.d(t,{JD:()=>i,Ng:()=>a,qm:()=>s})},779:(e,t,n)=>{"use strict";function a(e){return window.Handlebars.compile(e)}function s(e,t){let n;try{n=window.Handlebars.compile(e)(t)}catch(e){n=`Rendering exception: ${e}`}return n}function i(e,t,n,a=!1){let s;if(e){try{s=t(n)}catch(e){s=`Rendering exception: ${e}`}a?e.innerHTML+=s:e.innerHTML=s}else console.warn(`renderElement() nothing found for selector: ${e}`)}function r(e,t,n,a=!1){i(document.querySelector(e),t,n,a)}n.d(t,{F0:()=>s,XX:()=>r,dN:()=>i,vs:()=>a}),window.Handlebars.registerHelper("eachSorted",(function(e,t){let n=window.Handlebars.createFrame(t,t.hash),a="";for(const s of Object.keys(e).sort(((e,t)=>e.toLowerCase().localeCompare(t.toLowerCase()))))Object.prototype.hasOwnProperty.call(e,s)&&(n.key=s,a+=t.fn(e[s],{data:n}));return a})),window.Handlebars.registerHelper("notEmpty",(function(e,t){return e&&Object.keys(e).length>0?t.fn(this):t.inverse(this)})),window.Handlebars.registerHelper("reSub",(function(e,t,n){let a=n.fn(this);return"string"!=typeof a?a:a.replace(new RegExp(e,"g"),t)})),window.Handlebars.registerHelper("ifTrue",(function(e,t){return 1==e?t.fn(this):t.inverse(this)})),window.Handlebars.registerHelper("ifFalse",(function(e,t){return 1==e?t.fn(this):t.inverse(this)})),window.Handlebars.registerHelper("contains",(function(e,t,n){return e=window.Handlebars.escapeExpression(e),(t=window.Handlebars.escapeExpression(t)).indexOf(e)>-1?n.fn(this):n.inverse(this)})),window.Handlebars.registerHelper("compare",(function(e,t,n,a){var s={"==":e==n,"===":e===n,"!=":e!=n,"!==":e!==n,">":e>n,">=":e>=n,"<":e<n,"<=":e<=n,"||":!(!e&&!n),"&&":!(!e||!n)};return Object.prototype.hasOwnProperty.call(s,t)?s[t]?a.fn(this):a.inverse(this):console.error('Error: Expression "'+t+'" not found')}))},662:(e,t,n)=>{"use strict";n.d(t,{u:()=>a});class a{static#B={};static async get(e){let t;if(this.#B[e])return this.#B[e];switch(e){case"md":{const e=new window.showdown.Converter({tables:!0,metadata:!0,ghCodeBlocks:!0});e.setFlavor("github"),e.setOption("simpleLineBreaks",!1),t=e;break}case"Split":{const{default:e}=await import("lib_split");t=e;break}case"DOMPurify":{const{default:e}=await import("lib_dompurify");t=e;break}case"adoc":{const{default:e}=await import("lib_asciidoctor");t=new e;break}case"Mermaid":{const{default:e}=await import("lib_mermaid");e.initialize({startOnLoad:!1,securityLevel:"antiscript",logLevel:"error"}),t=e;break}case"rst":await import("lib_rst2html"),t=window.rst2html;break;default:throw new Error(`Unknown converter: ${e}`)}return this.#B[e]=t,this.#B[e]}}},240:(e,t,n)=>{"use strict";n.d(t,{r:()=>s});var a=n(551);class s{static#T={none:async()=>({model:"none",result:"ERROR: LLM chat bot is currently disabled in <a href='#/-/Settings'>Settings</a>. Please enable it to allow LLM prompts."}),huggingFace:async e=>{const t=await a.w.get("huggingFaceModel");return t?{model:"HuggingFace "+t,result:await this.#F({messages:[{role:"user",content:e}],model:t}).then((e=>{if(e.error)throw new Error(e.error.message);if(!e.choices||0===e.choices.length)throw new Error("No response from LLM model.");return e.choices[0].message.content})).catch((e=>"ERROR: "+e.message))}:{model:"HuggingFace ???",result:"ERROR: No model selected."}},ollama:async e=>{const t=await a.w.get("ollamaModel");return t?{model:"Ollama "+t,result:await fetch(`${await a.w.get("ollamaEndpoint")}/api/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,model:t,stream:!1})}).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).then((e=>{if(e.error)throw new Error(e.error);return e.response})).catch((e=>"ERROR: "+e.message))}:{model:"Ollama ???",result:"ERROR: No model selected."}}};static async updateOllamaModelList(){const e=await fetch(`${await a.w.get("ollamaEndpoint")}/api/tags`,{method:"GET"}).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}));await a.w.set("ollamaModels",e.models.map((e=>e.name)),!0)}static async#F(e){let t={"Content-Type":"application/json"};const n=await a.w.get("huggingFaceToken");n&&n.length>0&&(t.Authorization=`Bearer ${n}`);const s=await fetch("https://router.huggingface.co/v1/chat/completions",{headers:t,method:"POST",body:JSON.stringify(e)});return await s.json()}static async submit(e){const t=await a.w.get("chatType","none");return t&&this.#T[t]?await this.#T[t](e):{model:"unknown",result:`ERROR: Unknown chat provider: ${t}`}}}},933:(e,t,n)=>{"use strict";n.d(t,{m:()=>u});var a=n(189);class s{static async fetch(e){var t,n=await fetch(`https://api.github.com/repos/${e.github}`).then((e=>e.json())).then((n=>(t=n,fetch(`https://api.github.com/repos/${e.github}/git/trees/${n.default_branch}?recursive=1`)))).then((e=>e.json())).catch((e=>{throw new Error(`Error on Github request: ${e}'`)}));if(n.response&&n.response.test(/Too many requests/))throw new Error("Github API rate limit exceeded!");if(!n.tree)throw new Error("No 'tree' data when fetching from Github!");return{paths:n.tree.map((a=>({path:a.path,download:`https://raw.githubusercontent.com/${e.github}/${n.sha}/${a.path}`,edit:`https://github.com/${e.github}/edit/${t.default_branch}/${a.path}`}))),section:{url:t.html_url,author:t.owner.login,homepage:t.homepage,license:t.license,default_branch:t.default_branch}}}}class i{static async fetch(e){var t;return{data:await fetch(`https://gitlab.com/api/v4/projects/${encodeURIComponent(e.gitlab)}`).then((e=>e.json())).then((n=>(t=n,fetch(`https://gitlab.com/api/v4/projects/${encodeURIComponent(e.gitlab)}/repository/tree?ref=${n.default_branch}&recursive=true`)))).then((e=>e.json())),section:{url:t.html_url,author:t.owner.login,homepage:t.homepage,license:t.license,default_branch:t.default_branch}}}}var r=n(3);class o{static#M(e,t,n,a,s){r.w.addDocument(e,t,n,{type:"link",baseName:a.replace(/.*\//,""),baseUrl:a.replace(/\/[^/]+$/,""),editUrl:s})}static async documentDownload(e,t,n,a,s){navigator.storage&&navigator.storage.persist&&navigator.storage.persist(),await fetch(a).then((e=>e.text())).then((async i=>{r.w.addDocument(e,t,n,{data:i,baseName:a.replace(/.*\//,""),baseUrl:a.replace(/\/[^/]+$/,""),editUrl:s})}))}static#U(e,t=null,n){var a={match:e.match(n),target:null};return a.match&&(t?2==e.split(t).length?a.target=a.match[1].substring(t.length+1):a.match=null:a.target=a.match[1]),a}static async fetchNewSection(e,t,n,a){const o=n.filePattern?n.filePattern:"^(.+)\\.(md|markdown|rst|adoc|asciidoc)$",d=new RegExp(o);let c,l=[];if(n.github)console.log(`Fetching from ${n.github}...`),c=await s.fetch(n);else{if(!n.gitlab)throw new Error("Unsupported repo type!");console.log(`Fetching from ${n.gitlab}...`),c=await i.fetch(n)}let u=c.section;u.children=[],c.paths.forEach((s=>{var i=this.#U(s.path,n.folder,d);i.target&&(i.target=i.target.replace(/\//g,":::"),a?l.push(this.documentDownload(e,t,i.target,s.download,s.edit).then((()=>document.dispatchEvent(new CustomEvent("download-finished",{detail:s.path}))))):this.#M(e,t,i.target,s.download,s.edit),u.children.push(i.target))})),await r.w.addDocTree(e,t,u),await Promise.all(l)}}var d=n(648),c=n(84),l=n(551);class u{static getInstallable=async e=>window.Config.groups[e]?.catalog?await fetch(window.Config.groups[e].catalog.source).then((e=>e.json())).then((t=>{if(t)return t;throw new Error(`Error fetching ${e} catalog`)})):{};static async#P(e){try{for(const t of Object.keys(window.Config.groups[e].install)){const n=window.Config.groups[e].install[t];await this.install(e,t,n,void 0,!1)}}catch(t){console.error(`Error fetching index ${window.Config.indexUrls[e].index}: ${t}`)}}static async update(){const e=await r.w.getTree();if(await l.w.get("initialRun",!0)){console.log("Initial run. Initializing groups...");for(const t of Object.keys(window.Config.groups))window.Config.groups[t].install&&(e.nodes[t]||this.#P(t));await l.w.set("initialRun",!1),console.log("Initial run finished"),document.dispatchEvent(new CustomEvent("sections-updated"))}else{console.log("Checking for orphaned documents...");const t=await d.DB.getAllKeys("settings","settings");for(const n of t)if("string"==typeof n&&0==n.indexOf("document:::")){const t=n.split(/:::/);e.nodes[t[1]]&&e.nodes[t[1]].nodes&&e.nodes[t[1]].nodes[t[2]]||(console.log(`Dropping orphaned doc: ${n}`),l.w.remove(n))}console.log("Checking for missing sections...");for(const t of Object.keys(window.Config.groups))e.nodes[t]||window.Config.groups[t].removable||"Feeds"===t||(console.log(`Installing missing section: ${t}`),this.#P(t))}}static removeGroup(e){r.w.removeGroup(e),a.q.pathChanged(""),c.d.update()}static remove(e,t){r.w.remove(e,t),c.d.update()}static async install(e,t,n,a=void 0,s=!0){let i=document.createElement("pre");i.class="note",i.innerText="Fetching content...\n",a&&a.parentNode.append(i),await o.fetchNewSection(e,t,n,s).catch((e=>{console.error(`Error fetching '${t}' from ${n.github}: ${e}`),i.innerText+=`Error fetching '${t}' from ${n.github}: ${e}\n`})),document.dispatchEvent(new CustomEvent("sections-updated")),c.d.update()}}},648:(e,t,n)=>{"use strict";n.d(t,{DB:()=>a});class a{static#_={aggregator:{version:1,stores:{tree:{keyPath:"id",autoIncrement:!0},items:{keyPath:"id",autoIncrement:!0},favicons:{keyPath:"id",autoIncrement:!0}},indexes:{items:[{name:"nodeId",field:"value.nodeId",params:{unique:!1}}]}},settings:{version:1,stores:{settings:{keyPath:"id",autoIncrement:!0}},indexes:{}}};static#j=[];static async#A(e){if(!this.#_[e])throw new Error(`DB '${e}' not configured`);return this.#j[e]||(await new Promise(((t,n)=>{let a=this,s=indexedDB.open(e,a.#_[e].version);s.onsuccess=function(){a.#j[e]=this.result,t()},s.onerror=function(e){a.#j=void 0,n(`Error opening IndexedDB: ${e.target.errorCode}`)},s.onupgradeneeded=t=>{const n=a.#j[e]=t.currentTarget.result;console.log("IndexedDB onupgradeneeded");const s=a.#_[e].stores;Object.keys(s).forEach((t=>{n.objectStoreNames.contains(t)||(console.log(`Creating store '${t}' in IndexedDB ${e}`),n.createObjectStore(t,s[t]))}));const i=a.#_[e].indexes;Object.keys(i).forEach((a=>{if(n.objectStoreNames.contains(a)){const n=t.target.transaction.objectStore(a);for(const t of i[a])n.indexNames.contains(t.name)||(console.log(`Creating index '${t.name}' in store '${a}' of IndexedDB ${e}`),n.createIndex(t.name,t.field,t.params))}}))}})),window.DB=this),this.#j[e]}static async getByIndexOnly(e,t,n,a){const s=await this.#A(e);return await new Promise(((i,r)=>{const o=s.transaction(t,"readonly").objectStore(t);if(!o.indexNames.contains(n))return void r(`Index '${n}' does not exist in store '${t}'`);const d=o.index(n),c=[],l=d.openCursor(IDBKeyRange.only(a));l.onsuccess=e=>{const t=e.target.result;t?(c.push({id:t.id,...t.value}),t.continue()):i(c)},l.onerror=s=>r(`Error getting '${a}' from DB '${e}' store '${t}' index '${n}': ${s.target.errorCode}`)}))}static async getAllKeys(e,t){const n=await this.#A(e);return await new Promise(((a,s)=>{const i=n.transaction(t,"readonly").objectStore(t).getAllKeys();i.onsuccess=function(e){a(e.target.result)},i.onerror=function(n){s(`Error getting all keys from DB '${e}' store '${t}': ${n.target.errorCode}`)}}))}static async get(e,t,n,a="null"){const s=await this.#A(e);return await new Promise(((i,r)=>{const o=s.transaction(t,"readonly").objectStore(t).get(n);o.onsuccess=function(e){let t;t=e.target.result&&void 0!==e.target.result.value&&null!==e.target.result.value?e.target.result.value:a,i(t)},o.onerror=function(a){r(`Error getting '${n}' from DB '${e}' store '${t}' ${a.target.errorCode}`)}}))}static getById=async(e,t,n)=>{const a=await this.get(e,t,n);return a?{id:n,...a}:null};static async set(e,t,n,a){const s=await this.#A(e);await new Promise(((i,r)=>{const o=s.transaction(t,"readwrite").objectStore(t);try{const s=o.put(n?{id:n,value:a}:{value:a});s.onsuccess=function(){i()},s.onerror=function(a){r(`Error saving '${n}' in DB '${e}' store '${t}': ${a.target.errorCode}`)}}catch(a){r(`Error saving '${n}' in DB '${e}' store '${t}': ${a}`)}}))}static async remove(e,t,n){const a=await this.#A(e);await new Promise(((s,i)=>{const r=a.transaction(t,"readwrite").objectStore(t);try{r.delete(n),s()}catch(a){i(`Error deleting '${n}' DB '${e}' from store '${t}': ${a}`)}}))}static async removeOrphans(e,t,n,a){const s=await this.#A(e);await new Promise(((i,r)=>{const o=s.transaction(t,"readwrite").objectStore(t);try{let s=0;const r=o.index(n),d=IDBKeyRange.lowerBound(0);r.openCursor(d).onsuccess=r=>{const o=r.target.result;o?(a.includes(o.value.value[n])||(o.delete(),s++),o.continue()):(console.info(`Removed ${s} orphaned items from DB '${e}' store '${t}'`),i())}}catch(n){r(`Error deleting orphaned items from DB '${e}' store '${t}': ${n}`)}}))}}},84:(e,t,n)=>{"use strict";n.d(t,{d:()=>i});var a=n(3),s=n(551);class i{static#H="SearchIndexCache";static async getCache(){return await s.w.get(i.#H,void 0)}static async setCache(e){await s.w.set(i.#H,e)}static async clearCache(){await s.w.delete(i.#H)}static async getDocs(){const e=await a.w.getTree();let t={};return e.nodes&&Object.values(e.nodes).forEach((e=>{t={...t,...i.#q(e)}})),t}static#q(e){let t={};return e.nodes&&Object.values(e.nodes).forEach((e=>{console.log(`Adding index for ${e.id}`);const n=`${e.id.replace(/:::/g,"/")}`;t[n]={doc:n,id:e.id,title:e.name,content:e.content,relUrl:"#/"+n},t={...t,...i.#q(e)}})),t}static async update(){console.log("SearchIndex: Updating index...");const e=await i.getDocs();let t={docs:e,index:window.lunr((function(){this.ref("id"),this.field("title",{boost:200}),this.field("content",{boost:2}),this.field("relUrl"),this.metadataWhitelist=["position"];for(let t in e)this.add({id:t,title:e[t].title,content:e[t].content,relUrl:e[t].relUrl})}))};i.setCache({index:JSON.stringify(t.index),docs:t.docs}),document.dispatchEvent(new CustomEvent("search-index-updated",{detail:t})),console.log("SearchIndex: Updating index done.")}}},3:(e,t,n)=>{"use strict";n.d(t,{w:()=>s});var a=n(551);class s{static#V(e,t,n){let a={name:t,parent_id:e,id:e+":::"+t,runbook:n.runbook,url:n.url,author:n.author,license:n.license,homepage:n.homepage,nodes:{}};return n.children.forEach((s=>{console.log(`Adding ${s} to group ${e} section ${t}`);const i=s.split(/:::/);let r=a;for(let e=0;e<i.length-1;e++){const t=i[e];r.nodes[t]||(r.nodes[t]={name:t,id:r.id+":::"+t,parent_id:r.id,nodes:{}}),r=r.nodes[t]}r.nodes[i[i.length-1]]={name:i[i.length-1],id:r.id+":::"+i[i.length-1],parent_id:r.id,type:n.type}})),console.info(a),a}static async#o(e){await a.w.set("sections",e),document.dispatchEvent(new CustomEvent("sections-updated"))}static async remove(e,t){let n=await this.getTree(),s=n.nodes[e].nodes[t];if(s){for(const e of Object.keys(s.nodes))a.w.remove(`document:::${t}:::${e}`);await a.w.remove(`section:::${t}`),delete n.nodes[e].nodes[t],this.#o(n)}}static async removeGroup(e){let t=await this.getTree(),n=t.nodes[e];if(n){for(const t of Object.keys(n.nodes))await this.remove(e,t);delete t.nodes[e],this.#o(t)}}static async addDocTree(e,t,n){let a=await this.getTree();a.nodes[e]||(a.nodes[e]={nodes:{}}),a.nodes[e].nodes[t]=s.#V(e,t,n),this.#o(a)}static async get(e){let t=await this.getTree();for(const n of e.split(/:::/)){if(!t.nodes[n])return;t=t.nodes[n]}return t}static getTree=async()=>await a.w.get("sections",{nodes:{}});static getDocument=async e=>await a.w.get(`document:::${e}`,{});static addDocument=async(e,t,n,s)=>await a.w.set(`document:::${e}:::${t}:::${n}`,s)}},551:(e,t,n)=>{"use strict";n.d(t,{w:()=>s});var a=n(648);class s{static#_={};static async initialize(){this.#_=await a.DB.get("settings","settings","schema",{}),console.log("Settings schema:",this.#_)}static async addSchema(e){this.#_={...this.#_,...e},await a.DB.set("settings","settings","schema",this.#_,!1)}static get=async(e,t)=>await a.DB.get("settings","settings",e,t||this.#_[e]?.default);static async set(e,t,n=!0){await a.DB.set("settings","settings",e,t,n),n&&document.dispatchEvent(new CustomEvent("settings-changed",{detail:{name:e,value:t}}))}static remove=async e=>await a.DB.remove("settings","settings",e)}s.initialize()},388:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ChatView:()=>d});var a=n(240),s=n(913),i=n(662),r=n(551),o=n(779);class d{static#z;static addToolResult(e,t,n="text"){if(!e||!t)return;const a=s.ContentView.getViewElement("chat").querySelector(".content"),i=document.createElement("pre");if(i.classList.add("cli"),i.innerText+="$ "+e,"text"===n&&(i.innerText+="\n"+t),a.appendChild(i),"html"===n){const e=document.createElement("div");e.innerHTML=t,a.appendChild(e)}a.scrollIntoView({behavior:"smooth",block:"end"})}static async submitPrompt(e){if(0==e.length)return;const t=s.ContentView.getViewElement("chat"),n=t.querySelector(".content");let c,l;n.innerHTML+=o.F0('\n            <div class="question"><p>{{prompt}}</p></div>\n            <div class="loading"><i>Processing ...</i></div>\n        ',{prompt:e}),n.scrollIntoView({behavior:"smooth",block:"end"}),d.#z||(d.#z=await i.u.get("md")),r.w.get("AIPromptHistory",[]).then((t=>{t.push(e),t=t.slice(-15),r.w.set("AIPromptHistory",t)}));try{l=await a.r.submit(e)}catch(e){c=`<div class="answer">ERROR: Request failed (${encodeURI(e)})!</div>`}try{c=d.#z.makeHtml(l.result)}catch(e){c=`ERROR: Markdown parsing error (${encodeURIComponent(e)})!`}[...t.querySelectorAll(".loading")].forEach((e=>e.remove())),n.innerHTML+=`<div class="answer"><div class="llm">${l.model}</div>${c||"ERROR: Request failed!"}</div>`,n.scrollIntoView({behavior:"smooth",block:"end"})}}},943:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ChecksView:()=>i});var a=n(551),s=n(779);class i{constructor(e){Object.values(window.Config.toolboxComponents).forEach((e=>n(755)(e.import))),i.render(e),document.addEventListener("settings-changed",(t=>{0==t.detail.name.indexOf("toolEnabled:::")&&i.render(e)}))}static async render(e){Promise.all(Object.keys(window.Config.toolboxComponents).map((async e=>({name:e,embed:window.Config.toolboxComponents[e].embed,settings:window.Config.toolboxComponents[e].settings,enabled:await a.w.get("toolEnabled:::"+e,window.Config.toolboxComponents[e].enabled)})))).then((t=>{s.dN(e,s.vs('\n                <div class="checks">\n                    {{#each tools}}\n                    {{#ifTrue enabled}}\n                        <h3>\n                            {{name}}\n                            {{#if settings}}\n                                <a href="#/-/Settings/Tools/{{name}}" class="settings">‚öô</a>\n                            {{/if}}\n                        </h3>\n                        <div class="check">\n                            {{{embed}}}\n                        </div>\n                    {{/ifTrue}}\n                    {{/each}}\n                </div>\n            '),{tools:t})}))}}},913:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ContentView:()=>d});var a=n(3),s=n(789),i=n(209),r=n(965),o=n(779);class d{static#J={adoc:i.CheatSheetRenderer,rst:i.CheatSheetRenderer,asciidoc:i.CheatSheetRenderer,md:i.CheatSheetRenderer,htm:i.CheatSheetRenderer,html:i.CheatSheetRenderer,pdf:r.PdfRenderer};static#W={Catalog:{switch:"content",view:"Catalog"},CLI:{switch:"chat",view:void 0},Discover:{switch:"content",view:"Discover"},Feeds:{switch:"content",view:"Feeds"},Feed:{switch:"feedreader",view:"FeedReader"},Folder:{switch:"content",view:"Folder"},Settings:{switch:"content",view:"Settings"},OPFS:{switch:"content",view:"OPFSFileBrowser"}};constructor(e){o.dN(e,o.vs('       \n            <nav class="breadcrumb-nav">\n                <ol class="breadcrumb-nav-list" id="breadcrumb-nav"></ol>\n            </nav>\n\n            <div id="main-content-content" class="main-content-view">\n            </div>\n\n            <div id="main-content-search" class="main-content-view">\n                <div id="search-results" class="search-results">\n                    Loading ...\n                </div>\n            </div>\n\n            <div id="main-content-chat" class="main-content-view">\n                <p class="loading">\n                This is the combined CLI/chat view. By prefixing prompts with <code>?</code> you can ask questions here and get answers from the configured LLM.\n                Enter <code>!help</code> to see available CLI commands. Not using a prefix will perform a content search.\n                </p>\n\n                <div id="aiChatView">\n                    <div class="container">\n                        <div class="content">\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),{}),new s.HomeView(d.#G("content")),Array.from(document.getElementsByClassName("main-content-view")).forEach((e=>{e.onclick=()=>e.focus()}))}static#K=()=>document.getElementById("breadcrumb-nav").scrollIntoView({behavior:"instant",block:"center"});static#X(e,t){if(!Object.keys(d.#W).includes(e))return void(d.#G("content").innerHTML=`ERROR: No internal route for ${e}`);const a=d.#G(d.#W[e].switch),s=d.#W[e].view;s&&n(855)(`./${s}.js`).then((e=>{new e[`${s}View`](a,t)})).catch((e=>{d.#G("content").innerHTML=`ERROR: Loading view ${s} failed: ${e}`}))}static async render(e){if(d.#K(),0==e.indexOf("-/"))return void d.#X(e.split("/")[1],e);const t=e.replace(/\//g,":::");if((await a.w.get(t)).nodes)return void(-1==t.indexOf(":::")?d.#X("Catalog",e):d.#X("Folder",e));const n=await a.w.getDocument(t);if(!n)return i.innerHTML="<h1>ERROR: Document not found</h1>",void console.error(`No document found for ${e}`);const s=n.baseName.split(".").pop().toLowerCase(),i=d.#G("content");Object.keys(d.#J).includes(s)?await d.#J[s].load(i,n):i.innerHTML=`ERROR: No renderer for ${s} files`}static#G(e){let t;return document.title=window.Config.siteName,"feedreader"===e?(document.getElementById("main-content-wrap").style.display="none",t=document.getElementById("feedreader"),t.style.display="block",t):([...document.querySelectorAll(".main-content-view")].forEach((e=>e.style.display="none")),document.getElementById("main-content-wrap").style.display="block",t=document.getElementById(`main-content-${e}`),t.style.display="block","chat"!==e&&"search"!==e&&(t.innerHTML=""),t)}static getViewElement(e){return document.getElementById(`main-content-${e}`)}static showSearch(){d.#G("search")}static hideSearch(){window.location.hash.startsWith("#/-/CLI")?d.#G("chat"):d.#G("content")}}},789:(e,t,n)=>{"use strict";n.r(t),n.d(t,{HomeView:()=>r});var a=n(943),s=n(3),i=n(182);class r extends i.S{constructor(e){super({root:e,template:'\n                <div class="about">\n                    {{{ welcome }}}\n\n                    <div id=\'home-content\'>\n                        <h3>Content</h3>\n\n                        <div>\n                            {{#each sections.nodes as |groups groupId| }}\n                                <div>\n                                    <b>{{ @key }}</b>:\n                                    {{#each nodes}}\n                                        &nbsp;\n                                        <a href="#/{{ groupId }}/{{ @key }}">{{ @key }}</a>\n                                    {{/each}}\n                                </div>\n                            {{/each}}\n                        </div>\n                    </div>\n                </div>\n\n                <div id="toolpanelHome"></div>\n            ',mapper:async()=>({welcome:window.Config.welcome,sections:await s.w.getTree()})}),new a.ChecksView(document.getElementById("toolpanelHome"))}}},216:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Sidebar:()=>o});var a=n(218),s=n(3),i=n(217),r=n(779);class o{#g;static#D=r.vs('\n        {{#* inline "sidebarChildNode"}}\n            <li class="nav-list-item" data-path="{{ id }}">\n                {{#notEmpty nodes}}\n                    <a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>\n                {{/notEmpty}}\n                <a data-path="{{ id }}" class="nav-list-link" href="#/{{#reSub ":::" "/"}}{{id}}{{/reSub}}">{{ name }}</a>\n                <ul data-path="{{ id }}" class="nav-list">\n                    {{#each nodes }}\n                        {{> sidebarChildNode }}\n                    {{/each}}\n                </ul>\n            </li>\n        {{/inline}}\n\n        {{#each tree.nodes }}\n            <ul class="nav-list">\n                    <li class="nav-list-item" data-path="{{ @key }}">\n                            <a class="nav-list-link pwa-title" data-path="{{ @key }}" href="#/{{ @key }}">\n                                    {{ @key }}\n                            </a>\n                    </li>\n            </ul>\n            <ul class="nav-list">\n                {{#each nodes }}\n                    {{> sidebarChildNode }}\n                {{/each}}\n            </ul>\n        {{/each}}\n\n        {{#* inline "sidebarChildFeed"}}\n                {{#compare type \'==\' \'feed\'}}\n                <li class=\'nav-list-item context-node\' data-type=\'{{type}}\' data-id=\'{{id}}\'>\n                    <a data-path="-:::Feed:::{{id}}" class="nav-list-link" href="#/-/Feed/{{id}}">\n                        <div class="{{type}}">\n                            {{#if error}}\n                                ‚õî&nbsp;\n                            {{else}}\n                                {{#if iconData}}\n                                    <img class=\'icon\' src=\'{{iconData}}\'/>\n                                {{else}}\n                                    <img class=\'icon\' src=\'default.svg\'/>\n                                {{/if}}\n                            {{/if}}\n                            <span class=\'title\'>\n                                {{{title}}}\n                            </span>\n                            <span class=\'count\' data-count=\'{{unreadCount}}\'>{{unreadCount}}</span>\n                        </div>\n                    </a>\n                </li>\n                {{/compare}}\n                {{#compare type \'==\' \'folder\'}}\n                <li class=\'nav-list-item context-node\' data-type=\'{{type}}\' data-id=\'{{id}}\'>\n                    {{#notEmpty children}}\n                        <a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>\n                    {{/notEmpty}}\n                    <a data-path="-:::Folder:::{{id}}" class="nav-list-link" href="#/-/Folder/{{id}}">\n                        <div class="{{type}}">\n                            <span class=\'title\'>\n                                üìÅ&nbsp;\n                                {{{title}}}\n                            </span>\n                            <span class=\'count\' data-count=\'{{unreadCount}}\'>{{unreadCount}}</span>\n                        </div>\n                    </a>\n                    <ul class=\'nav-list feeds\'>\n                        {{#each children }}\n                            {{> sidebarChildFeed }}\n                        {{/each}}\n                    </ul>\n                </li>\n                {{/compare}}\n        {{/inline}}\n   \n        \x3c!-- FeedReader section --\x3e\n        <ul class="nav-list">\n                <li class="nav-list-item context-node" data-type=\'folder\' data-path="feeds" data-id=\'0\'>\n                        <a class="nav-list-link pwa-title" data-path="feeds" href="#/-/Feeds">\n                                Feeds\n                        </a>\n                </li>\n        </ul>\n        <div id="feedlist">\n            <ul class="nav-list" id=\'feedlistViewContent\'>\n                {{#each feedlist.children }}\n                    {{> sidebarChildFeed }}\n                {{/each}}\n            </ul>\n        </div>\n    ');constructor(e){this.#g=e,this.#O(),e.addEventListener("dragover",this.#Y.bind(this)),e.addEventListener("dragleave",this.#Q.bind(this)),e.addEventListener("dragend",this.#Q.bind(this)),e.addEventListener("drop",this.#Z.bind(this)),document.addEventListener("nodeRemoved",this.#O),document.addEventListener("nodeUpdated",(t=>{const n=t.detail.id,a=e.querySelector(`#feedlist .nav-list-item[data-id="${n}"]`);if(a){const e=a.querySelector(".title"),n=a.querySelector(".count"),s=a.querySelector(".icon");e.textContent!=t.detail.title&&(e.textContent=t.detail.title),n.textContent!=""+t.detail.unreadCount&&(n.textContent=t.detail.unreadCount),n.dataset.count=t.detail.unreadCount,s&&t.detail.iconData&&(s.src=t.detail.iconData)}else this.#O()})),document.addEventListener("sections-updated",this.#O),e.addEventListener("click",(e=>{var t=e.target;for(this.#g.focus();t&&(!t.classList||!t.classList.contains("nav-list-expander"));)t=t.parentNode;t&&(e.preventDefault(),t.parentNode.classList.toggle("active"))})),e.addEventListener("auxclick",(e=>{var t=e.target;if(1===e.button){for(;t&&!t.classList.contains("nav-list-item");)t=t.parentNode;t&&t.classList.contains("nav-list-item")&&(e.preventDefault(),i.r.dispatch(`sidebar:${t.dataset.type}:middleClick`,t.dataset))}}))}#Z(e){let t;e.preventDefault(),t=e.dataTransfer.getData("text/plain"),t||(t=e.dataTransfer.getData("text/x-moz-url")),t||(t=e.dataTransfer.getData("text/url-list")[0]),alert("Dropped URL: "+t),this.#g.classList.remove("drag-over")}#Y(e){e.preventDefault(),this.#g.classList.add("drag-over")}#Q=()=>this.#g.classList.remove("drag-over");#O=async()=>r.dN(this.#g,o.#D,{tree:await s.w.getTree(),feedlist:a.f.root});static selectionChanged(e){const t=e.replace(/\/$/,"").replaceAll(/\//g,":::").replace(/:::Item:::[^:]*$/,"");try{const n=document.getElementById("sidebar");if(Array.from(n.getElementsByClassName("active")).forEach((e=>e.classList.remove("active"))),Array.from(n.getElementsByClassName("selected")).forEach((e=>e.classList.remove("selected"))),""===e)return;let a=t;for(;-1!==a.indexOf(":::");)Array.from(n.querySelectorAll(`li[data-path="${a}"]`)).forEach((e=>e.classList.add("active"))),a=a.replace(/:::[^:]*$/,"");const s=n.querySelector(`a[data-path="${t}"]`);s?.classList.add("active"),s?.classList.add("selected"),s?.scrollIntoView({block:"nearest"})}catch(e){console.error(`select "${t}" caused: ${e}`)}}}},209:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CheatSheetRenderer:()=>i});var a=n(779),s=n(662);class i{static#ee=a.vs("\n        <div class='video'>\n            <a href='{{ href }}'>\n                <img src='https://i.ytimg.com/vi/{{ ytid }}/hqdefault.jpg'/>\n            </a>\n            <div class='title'>{{ title }}</div>\n            <div class='caption'>{{ caption }}</div>\n        </div>\n    ");static#te(e){const t=new RegExp("^https://www\\.youtube\\.com/watch\\?v=");e.querySelectorAll('a[href*="https://www.youtube.com/watch?v="]').forEach((e=>{const n=e.innerText.split(/---/);e.innerHTML=this.#ee({href:e.href,ytid:e.href.replace(t,""),title:n[0],caption:n[1]})}))}static async renderDocument(e,t){let n=encodeURI(t.baseUrl);if("link"===t.type&&(e.innerHTML=`Fetching content from <a href="${t.baseUrl}">${t.baseUrl}</a>...`,t.data=await fetch(n+"/"+t.baseName).then((e=>e.text()))),!t.data)return;let a="",i={};try{t.baseName?.match(/\.rst$/)?a=(await s.u.get("rst"))(t.data):t.baseName?.match(/\.(adoc|asciidoc)$/)?a=(await s.u.get("adoc")).convert(t.data):(t.data=t.data.replace(/(\[[^\]]+\])\(\//g,"$1("+n+"/"),a=(await s.u.get("md")).makeHtml(t.data),i=(await s.u.get("md")).getMetadata()),a=(await s.u.get("DOMPurify")).sanitize(a)}catch(e){console.error(e),a="ERROR: Content rendering error!"}return a=a.replace(/<img /g,'<img loading="lazy" '),e.innerHTML=a.replace(/(<img[^>]src=["'])\//g,"$1"+n+"/").replace(/(<img[^>]+src=["'])([^h:][^t][^t][^p])/g,"$1"+n+"/$2").replace(/(<a[^>]+href=["'])([^#h:][^t][^t][^p])/g,"$1"+n+"/$2"),"true"===i?.videoEmbed&&this.#te(e),await(await s.u.get("Mermaid")).run({querySelector:".main-content-view .mermaid"}),t}static async load(e,t){await this.renderDocument(e,t),-1==e.innerHTML.indexOf("<h1")&&e.insertAdjacentHTML("afterbegin",`<h1>${t.baseName.replace(/\.[^.]*$/,"")}</h1>`);var n=document.getElementsByTagName("h1")[0];n&&t&&(t?.editUrl&&(n.innerHTML+=`<button id='editBtn' title='Edit in Github' data-edit-url="${t.editUrl}" class="btn">Edit</button>`),t?.editUrl&&(document.getElementById("editBtn").onclick=e=>{window.open(e.target.dataset.editUrl,"_blank")}))}}},965:(e,t,n)=>{"use strict";n.r(t),n.d(t,{PdfRenderer:()=>a});class a{static async load(e,t){const n=await import("./vendor/pdf.mjs"),a=await import("./vendor/pdf_viewer/pdf_viewer.mjs");e.innerHTML='\n\t\t\t<div id="viewerContainer">\n\t\t\t\t<div id="viewer" class="pdfViewer"></div>\n\t\t\t</div>\n\t\t';const s=e.querySelector("#viewerContainer");s.style="position: absolute; width: 100%; height: 100%; overflow: auto;",n.GlobalWorkerOptions.workerSrc="vendor/pdf.worker.mjs";const i=t.baseUrl+"/"+t.baseName,r=new URL("vendor/pdf.sandbox.mjs",window.location),o=new a.EventBus,d=new a.PDFLinkService({eventBus:o}),c=new a.PDFFindController({eventBus:o,linkService:d}),l=new a.PDFScriptingManager({eventBus:o,sandboxBundleSrc:r}),u=new a.PDFViewer({container:s,eventBus:o,linkService:d,findController:c,scriptingManager:l});d.setViewer(u),l.setViewer(u),o.on("pagesinit",(function(){u.currentScaleValue="page-width"}));const h=n.getDocument({url:i,enableXfa:!0}),p=await h.promise;u.setDocument(p),d.setDocument(p,null)}}}},a={};function s(e){var t=a[e];if(void 0!==t)return t.exports;var i=a[e]={exports:{}};return n[e](i,i.exports,s),i.exports}s.m=n,s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,n)=>(s.f[n](e,t),t)),[])),s.u=e=>"bundle-"+e+".js",s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="lzone.de:",s.l=(n,a,i,r)=>{if(e[n])e[n].push(a);else{var o,d;if(void 0!==i)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var u=c[l];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+i){o=u;break}}o||(d=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.setAttribute("data-webpack",t+i),o.src=n),e[n]=[a];var h=(t,a)=>{o.onerror=o.onload=null,clearTimeout(p);var s=e[n];if(delete e[n],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach((e=>e(a))),t)return t(a)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),d&&document.head.appendChild(o)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="/js/bundle/",(()=>{var e={792:0};s.f.j=(t,n)=>{var a=s.o(e,t)?e[t]:void 0;if(0!==a)if(a)n.push(a[2]);else{var i=new Promise(((n,s)=>a=e[t]=[n,s]));n.push(a[2]=i);var r=s.p+s.u(t),o=new Error;s.l(r,(n=>{if(s.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var i=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",o.name="ChunkLoadError",o.type=i,o.request=r,a[1](o)}}),"chunk-"+t,t)}};var t=(t,n)=>{var a,i,[r,o,d]=n,c=0;if(r.some((t=>0!==e[t]))){for(a in o)s.o(o,a)&&(s.m[a]=o[a]);d&&d(s)}for(t&&t(n);c<r.length;c++)i=r[c],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunklzone_de=self.webpackChunklzone_de||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),s(189)})();