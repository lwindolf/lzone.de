(()=>{"use strict";var t={169(t,e,n){var s;function a(){return new Promise((t,e)=>{s&&t();let n=indexedDB.open("dns-checker",1);n.onsuccess=function(){s=this.result,t()},n.onerror=function(t){e(`Error opening IndexedDB: ${t.target.errorCode}`)},n.onupgradeneeded=function(t){s=t.currentTarget.result,console.log("IndexedDB onupgradeneeded"),s.createObjectStore("settings",{keyPath:"id",autoIncrement:!0})}})}function i(t,e=null){return a().then(()=>new Promise((n,a)=>{let i=s.transaction("settings","readonly").objectStore("settings").get(t);i.onsuccess=function(t){let s=t.target.result;n(s?s.value:e)},i.onerror=function(t){a(`Error getting setting ${t.target.errorCode}`)}}))}function r(t,e){return a().then(()=>new Promise((n,a)=>{let i=s.transaction("settings","readwrite").objectStore("settings");try{i.put({id:t,value:e}),n()}catch(e){a(`Error saving setting ${t}: ${e}`)}}))}n.d(e,{C:()=>i,o:()=>r})},218(t,e,n){var s=n(551),a=n(779);class i extends HTMLElement{#t=60;#e;#n;#s;#a;#i;constructor(){super(),this.attachShadow({mode:"open"}),this.#s=this.shadowRoot.host.dataset.path,this.#i=document.createElement("div"),this.#a=document.createElement("span"),this.#a.classList.add("date");const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href",(this.#s?this.#s:"")+"css/style.css");const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","css/main.css"),this.shadowRoot.append(this.#i),this.shadowRoot.append(this.#a),this.shadowRoot.appendChild(t),this.shadowRoot.appendChild(e),this.#r(),s.w.get("refreshInterval",this.#t).then(t=>{this.#t=t,setInterval(async()=>{await this.#r()},60*t*1e3)}),document.addEventListener("BadgeCheckerRefresh",t=>{this.#r(),t.stopPropagation()})}#o(t){this.#a.innerHTML=t}async#r(){this.#i.innerHTML="",this.#n=await s.w.get("badgesLastUpdated",0),this.#e=await s.w.get("badges",{}),Object.entries(this.#e).forEach(([t,e])=>{this.#i.innerHTML+=`\n                <div class="badge">\n                        <span class="badge_name">${t}</span>\n                        <img src="${e}" alt="Badge for ${t}">\n                </div>\n                `}),this.#n=Date.now(),this.#o(`Last updated: ${new Date(this.#n).toLocaleString()}`)}}class r extends HTMLElement{#d;constructor(){super(),this.attachShadow({mode:"open"}),this.#d=document.createElement("div");const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","css/main.css"),this.shadowRoot.appendChild(t),this.shadowRoot.append(this.#d),this.render()}async render(){const t=await s.w.get("badges",{});console.log(t),this.#d.innerHTML=a.F0('\n\t\t    <p>\n\t\t    \tThe badge widget can be used to have an overview over all build pipelines\n                you care about. Simply add the badge name and image URL below.\n\t\t    </p>\n\n\t\t\t<h3>Configured Badges</h3>\n\n            {{#each badges}}\n\t\t\t\t<div data-id="{{@key}}">\n\t\t\t\t\t<button data-id="{{@key}}">Remove</button>\n\t\t\t\t\t<span class="badge">{{@key}}</span>\n                    <img src="{{.}}" alt="Badge for {{@key}}">\n\t\t\t\t</div>\n            {{/each}}\n\n\t\t\t<h3>Add Badge</h3>\n\n\t\t\t<div>\n\t\t\t\t<input type="text" name="id" placeholder="Name of the badge">\n                <input type="text" name="url" placeholder="Image URL of the badge">\n\t\t\t\t<button id="add">Add</button>\n\t\t\t</div>\n\t\t',{badges:t}),this.#d.querySelectorAll("button[data-badge]").forEach(e=>{e.addEventListener("click",async e=>{const n=e.target.dataset.id;n&&(delete t[n],await s.w.set("badges",t))})}),this.#d.querySelector("#add").addEventListener("click",async()=>{const e=this.#d.querySelector('input[name="id"]').value.trim(),n=this.#d.querySelector('input[name="url"]').value.trim();e&&n&&(t[e]=n,await s.w.set("badges",t)),this.render()})}}customElements.define("x-badge-checker",i),customElements.define("x-badge-checker-settings",r)},290(t,e,n){var s=n(169);class a extends HTMLElement{#t=120;#c="ok";#l="new";#h="gone";#u="changed";#p;#n;#m;#s;#a;#i;static initialize(){window.app.Commands.register({dig:{syntax:"dig [<type>] <domain>",summary:"Simple Cloudflare DoH lookup",func:async t=>{let e=t[2]?t[1]:"A",n=t[2]?t[2]:t[1];const s=await fetch(`https://cloudflare-dns.com/dns-query?name=${n}&type=${e}`,{headers:{Accept:"application/dns-json"}}).then(t=>t.json());return["text",JSON.stringify(s,null,2)]}},crtsh:{syntax:"crtsh <domain>",summary:"Simple certificate lookup via crt.sh",func:async t=>["text",JSON.stringify(await a.#g(t[1]),null,2)]},dns:{syntax:"dns <domain>",summary:"Simple lookup for standard DNS records via Cloudflare",func:async t=>["text",Object.values(await a.#f(t[1])).join("\n")]}})}constructor(){super(),this.attachShadow({mode:"open"}),this.#s=this.shadowRoot.host.dataset.path,this.#i=document.createElement("div"),this.#a=document.createElement("span"),this.#a.classList.add("date");const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href",(this.#s?this.#s:"")+"css/style.css");const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","css/main.css"),this.shadowRoot.append(this.#i),this.shadowRoot.append(this.#a),this.shadowRoot.appendChild(t),this.shadowRoot.appendChild(e),this.#m=!1,this.#r(),(0,s.C)("refreshInterval",this.#t).then(t=>{this.#t=t,setInterval(async()=>{await this.#r()},60*t*1e3)}),document.addEventListener("DnsCheckerRefresh",t=>{this.#r(),t.stopPropagation()}),this.#i.addEventListener("click",t=>{const e=t.target.closest(".domain");e&&this.#v(e)})}#v(t){const e=this.#i.querySelector(".domain.details_on");e&&e.classList.remove("details_on"),t!==e&&t.classList.toggle("details_on")}#o(t){this.#a.innerHTML=t}#w(t){if(!t)return"Not enumerated yet.";const e=Object.keys(t).map(e=>t[e].records?Object.values(t[e].records).filter(t=>t.value).map(t=>t.value).join("<br/>"):"Not resolved yet!").join("<br/>");return this.dispatchEvent(new CustomEvent("check-result-event",{bubbles:!0,composed:!0,detail:{warnings:0,name:"DNS"}})),e}#y(t){const e=t.dataset.domain;(0,s.C)(`domain:::${e}`,{updated:0,subdomains:{}}).then(n=>{t.innerHTML=`\n\t\t\t\t<div class='probe probe_normal'>${e}</div>\n\t\t\t\t<div class='domain_details'>\n\t\t\t\t\t<pre>${this.#w(n.subdomains)}</pre>\n\t\t\t\t</div>\n\t\t\t`,this.#o(`Last updated: ${new Date(this.#n).toLocaleString()}`)})}static#b(t,e){return e.sort().map(e=>`${e.name} ${t} ${e.data}`).join("\n")}static async#f(t){const e={};for(const n of["A","AAAA","NS","SOA","TXT","CNAME","PTR","SRV","MX","CAA"])await fetch(`https://cloudflare-dns.com/dns-query?name=${t}&type=${n}`,{headers:{Accept:"application/dns-json"}}).then(t=>t.json()).then(t=>{t.Answer&&(e[n]=a.#b(n,t.Answer||[]))});return e}async#E(t,e){const n=await(0,s.C)(`domain:::${e}`,{updated:0,subdomains:{}});Object.keys(n.subdomains).forEach(async i=>{this.#o(`<i>Resolving '${i}'...</i>`);const r=n.subdomains[i];r.records||(r.records={});for(const t of["A","AAAA","NS","SOA","TXT","CNAME","PTR","SRV","MX","CAA"]){const e=await fetch(`https://cloudflare-dns.com/dns-query?name=${i}&type=${t}`,{headers:{Accept:"application/dns-json"}}).then(t=>t.json());r.records[t]||(r.records[t]={});const n=r.records[t];n.value&&(n.oldValue=n.value,n.value=void 0),"Answer"in e&&(n.value=a.#b(t,e.Answer))}n.updated=(new Date).getTime(),this.#n=(new Date).getTime(),await(0,s.o)(`domain:::${e}`,n),await(0,s.o)("domainsLastUpdated",this.#n),this.#y(t)})}static async#g(t){const e=await fetch(`https://crt.sh/json?q=${t}`);return await e.json()}async#A(t,e){const n=await(0,s.C)(`domain:::${e}`,{updated:0,subdomains:{}});if(!(n.updated<(new Date).getTime()-60*this.#t*1e3))return;console.log(`Checking domain ${e}`),this.#o(`<i>Enumerating '${e}'...</i>`);const i=await a.#g(e);let r={};Object.keys(n.subdomains).forEach(t=>n.subdomains[t].status=this.#h);for(const t of i)for(const e of t.name_value.split(/\n/)){let t=e.replace(/^\*\./,"");const s=n.subdomains[t];s?s.status=this.#c:r[t]={status:this.#l,alert:!0}}Object.entries(n.subdomains).filter((t,e)=>e.status==this.#h).forEach((t,e)=>e.alert=!0),n.subdomains={...n.subdomains,...r},await(0,s.o)(`domain:::${e}`,n),this.#y(t),this.#E(t,e)}async#r(){this.#m?console.log("DNS update already in progess."):(this.#m=!0,this.#o("<i>Checking...</i>"),this.#i.innerHTML="",this.#n=await(0,s.C)("domainsLastUpdated",0),this.#p=await(0,s.C)("domainList",["lzone.de"]),this.#p.forEach(t=>{var e=document.createElement("span");e.className="domain",e.setAttribute("data-domain",t),e.onclick=this.toggleDetails,this.#i.append(e),this.#y(e),this.#A(e,t)}),this.#m=!1)}}class i extends HTMLElement{#d;constructor(){super(),this.attachShadow({mode:"open"}),this.#d=document.createElement("div");const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","css/main.css"),this.shadowRoot.appendChild(t),this.shadowRoot.append(this.#d),this.render()}async render(){const t=await(0,s.C)("domainList",["lzone.de"]);this.#d.innerHTML=`\n\t\t    <p>\n\t\t    \tFIXME: you currently have to refresh the page to see the changes take effect\n\t\t    \tin the DNS Checker widget.\n\t\t    </p>\n\n\t\t\t<p>\n\t\t\t\t<b>Important: Checks will be performed with the help of external services</b>\n\t\t\t\t<ul>\n\t\t\t\t\t<li><a href="https://crt.sh">crt.sh</a> for subdomain enumeration</li>\n\t\t\t\t\t<li><a href="https://cloudflare-dns.com">cloudflare-dns.com</a> for DNS queries</li>\n\t\t\t\t</ul>\n\t\t\t\twhich may both log your domain queries. Do use with care!\n\t\t\t</p>\n\n\t\t\t<h3>Currently Checked Domains</h3>\n\n\t\t\t${t.map(t=>`\n\t\t\t\t<div data-domain="${t}">\n\t\t\t\t\t<button data-domain="${t}">Remove</button>\n\t\t\t\t\t<span class="domain">${t}</span>\n\t\t\t\t</div>\n\t\t\t`).join("")}\n\n\t\t\t<h3>Add Domain</h3>\n\n\t\t\t<div>\n\t\t\t\t<input type="text" id="domain" placeholder="Domain to check">\n\t\t\t\t<button id="addDomain">Add</button>\n\t\t\t</div>\n\t\t`,this.#d.querySelectorAll("button[data-domain]").forEach(e=>{e.addEventListener("click",async e=>{const n=e.target.dataset.domain;n&&(await(0,s.o)("domainList",t.filter(t=>t!==n)),this.#d.querySelector(`div[data-domain="${n}"]`).remove())})}),this.#d.querySelector("#addDomain").addEventListener("click",async()=>{const e=this.#d.querySelector("#domain").value.trim();e&&await(0,s.o)("domainList",[...t,e]),this.render()})}}customElements.define("x-dns-checker",a),customElements.define("x-dns-checker-settings",i),a.initialize()},551(t,e,n){n.d(e,{w:()=>a});var s=n(648);class a{static get=async(t,e)=>await s.DB.get("settings","settings",t,e);static async set(t,e,n=!0){await s.DB.set("settings","settings",t,e,n),n&&document.dispatchEvent(new CustomEvent("settings-changed",{detail:{name:t,value:e}}))}static remove=async t=>await s.DB.remove("settings","settings",t)}},638(t,e,n){var s=n(779),a=n(551);class i extends HTMLElement{#i;constructor(){super(),this.attachShadow({mode:"open"}),this.#i=document.createElement("div");const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","css/main.css"),this.shadowRoot.appendChild(t),this.shadowRoot.append(this.#i),this.#r(),document.addEventListener("settings-changed",t=>{"pinnedApps"===t.detail.name&&this.#r()})}async#r(){s.dN(this.#i,s.vs('\n            <div class="apps-pinned">\n            {{#each pinnedApps}}\n                <div class="app">\n                    <a class="favicon" href="{{url}}" target="_blank" rel="noopener noreferrer" title="{{@key}} ({{description}})">\n                    {{#if favicon}}\n                            <img class="favicon" src="{{favicon}}" alt="{{@key}}" onerror="this.classList.add(\'error\')">\n                    {{else}}\n                            <img class="favicon" src="{{url}}/favicon.ico" alt="{{@key}}" onerror="this.classList.add(\'error\')">\n                    {{/if}}\n                    </a>\n                </div>\n            {{/each}}\n            <a href="#/-/Settings/Tools/Pinned Apps" class="add">+</a>\n            </div>\n        '),{pinnedApps:await a.w.get("pinnedApps",{})})}}class r extends HTMLElement{#$;constructor(){super(),this.attachShadow({mode:"open"}),this.#$=document.createElement("div");const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","css/main.css"),this.shadowRoot.appendChild(t),this.shadowRoot.append(this.#$),this.render()}async render(){s.dN(this.#$,s.vs('\n            {{#* inline "app" }}\n                <div class="app">\n                    <a class="favicon" href="{{url}}" target="_blank">\n                    {{#if favicon}}\n                            <img class="favicon" alt="{{@key}}" src="{{favicon}}" onerror="this.classList.add(\'error\')">\n                    {{else}}\n                            <img class="favicon" alt="{{@key}}" src="{{url}}/favicon.ico" onerror="this.classList.add(\'error\')">\n                    {{/if}}\n                    </a>\n                    <div class="title">\n                        <a class="title" href="{{url}}">{{@key}}</a>\n                        <button data-name="{{@key}}">\n                            {{#if pinned }}\n                                Unpin\n                            {{else}}\n                                Pin\n                            {{/if}}\n                        </button>\n                    </div>\n                    <div class="description">{{description}}</div>\n                </div>\n            {{/inline}}\n\n            <p>\n                This is a catalog of useful web apps that you can pin for quick access. Depending\n                on the layout the apps will be shown in the sidebar or on the home page.\n            </p>\n\n            <div class="app-catalog">\n                <h2>Pinned</h2>\n                {{#each pinnedApps}}\n                    {{> app pinned=true }}\n                {{/each}}\n\n                {{#each apps}}\n                    <h2>{{@key}}</h2>\n                    <div class="group" data-group="{{@key}}">\n                    {{#each .}}\n                        {{#unless (lookup ../../pinnedApps @key) }}\n                            {{> app }}\n                        {{/unless}}\n                    {{/each}}\n                    </div>\n                {{/each}}\n            </div>\n        '),{apps:window.Config.apps,pinnedApps:await a.w.get("pinnedApps",{})}),this.#$.querySelectorAll(".app-catalog .app button").forEach(t=>{t.addEventListener("click",async t=>{const e=t.target,n=e.getAttribute("data-name");if(n){let t=await a.w.get("pinnedApps",{});if(n in t)delete t[n];else{const s=e.closest(".group").getAttribute("data-group");t[n]=window.Config.apps[s][n]}await a.w.set("pinnedApps",t),this.render()}})})}}customElements.define("x-pinned-apps",i),customElements.define("x-pinned-apps-settings",r)},648(t,e,n){n.d(e,{DB:()=>s});class s{static#S={aggregator:{version:1,stores:{tree:{keyPath:"id",autoIncrement:!0},items:{keyPath:"id",autoIncrement:!0},favicons:{keyPath:"id",autoIncrement:!0}},indexes:{items:[{name:"nodeId",field:"value.nodeId",params:{unique:!1}}]}},settings:{version:1,stores:{settings:{keyPath:"id",autoIncrement:!0}},indexes:{}}};static#k=[];static async#D(t){if(!this.#S[t])throw new Error(`DB '${t}' not configured`);return this.#k[t]||(await new Promise((e,n)=>{let s=this,a=indexedDB.open(t,s.#S[t].version);a.onsuccess=function(){s.#k[t]=this.result,e()},a.onerror=function(t){s.#k=void 0,n(`Error opening IndexedDB: ${t.target.errorCode}`)},a.onupgradeneeded=e=>{const n=s.#k[t]=e.currentTarget.result;console.log("IndexedDB onupgradeneeded");const a=s.#S[t].stores;Object.keys(a).forEach(e=>{n.objectStoreNames.contains(e)||(console.log(`Creating store '${e}' in IndexedDB ${t}`),n.createObjectStore(e,a[e]))});const i=s.#S[t].indexes;Object.keys(i).forEach(s=>{if(n.objectStoreNames.contains(s)){const n=e.target.transaction.objectStore(s);for(const e of i[s])n.indexNames.contains(e.name)||(console.log(`Creating index '${e.name}' in store '${s}' of IndexedDB ${t}`),n.createIndex(e.name,e.field,e.params))}})}}),window.DB=this),this.#k[t]}static async getByIndexOnly(t,e,n,s){const a=await this.#D(t);return await new Promise((i,r)=>{const o=a.transaction(e,"readonly").objectStore(e);if(!o.indexNames.contains(n))return void r(`Index '${n}' does not exist in store '${e}'`);const d=o.index(n),c=[],l=d.openCursor(IDBKeyRange.only(s));l.onsuccess=t=>{const e=t.target.result;e?(c.push({id:e.id,...e.value}),e.continue()):i(c)},l.onerror=a=>r(`Error getting '${s}' from DB '${t}' store '${e}' index '${n}': ${a.target.errorCode}`)})}static async getAllKeys(t,e){const n=await this.#D(t);return await new Promise((s,a)=>{const i=n.transaction(e,"readonly").objectStore(e).getAllKeys();i.onsuccess=function(t){s(t.target.result)},i.onerror=function(n){a(`Error getting all keys from DB '${t}' store '${e}': ${n.target.errorCode}`)}})}static async get(t,e,n,s="null"){const a=await this.#D(t);return await new Promise((i,r)=>{const o=a.transaction(e,"readonly").objectStore(e).get(n);o.onsuccess=function(t){let e;e=t.target.result&&void 0!==t.target.result.value&&null!==t.target.result.value?t.target.result.value:s,i(e)},o.onerror=function(s){r(`Error getting '${n}' from DB '${t}' store '${e}' ${s.target.errorCode}`)}})}static getById=async(t,e,n)=>{const s=await this.get(t,e,n);return s?{id:n,...s}:null};static async set(t,e,n,s){const a=await this.#D(t);await new Promise((i,r)=>{const o=a.transaction(e,"readwrite").objectStore(e);try{const a=o.put(n?{id:n,value:s}:{value:s});a.onsuccess=function(){i()},a.onerror=function(s){r(`Error saving '${n}' in DB '${t}' store '${e}': ${s.target.errorCode}`)}}catch(s){r(`Error saving '${n}' in DB '${t}' store '${e}': ${s}`)}})}static async remove(t,e,n){const s=await this.#D(t);await new Promise((a,i)=>{const r=s.transaction(e,"readwrite").objectStore(e);try{r.delete(n),a()}catch(s){i(`Error deleting '${n}' DB '${t}' from store '${e}': ${s}`)}})}static async removeOrphans(t,e,n,s){const a=await this.#D(t);await new Promise((i,r)=>{const o=a.transaction(e,"readwrite").objectStore(e);try{let a=0;const r=o.index(n),d=IDBKeyRange.lowerBound(0);r.openCursor(d).onsuccess=r=>{const o=r.target.result;o?(s.includes(o.value.value[n])||(o.delete(),a++),o.continue()):(console.info(`Removed ${a} orphaned items from DB '${t}' store '${e}'`),i())}}catch(n){r(`Error deleting orphaned items from DB '${t}' store '${e}': ${n}`)}})}}},779(t,e,n){function s(t){return window.Handlebars.compile(t)}function a(t,e){let n;try{n=window.Handlebars.compile(t)(e)}catch(t){n=`Rendering exception: ${t}`}return n}function i(t,e,n,s=!1){let a;if(t){try{a=e(n)}catch(t){a=`Rendering exception: ${t}`}s?t.innerHTML+=a:t.innerHTML=a}else console.warn(`renderElement() nothing found for selector: ${t}`)}n.d(e,{F0:()=>a,dN:()=>i,vs:()=>s}),window.Handlebars.registerHelper("eachSorted",function(t,e){let n=window.Handlebars.createFrame(e,e.hash),s="";for(const a of Object.keys(t).sort((t,e)=>t.toLowerCase().localeCompare(e.toLowerCase())))Object.prototype.hasOwnProperty.call(t,a)&&(n.key=a,s+=e.fn(t[a],{data:n}));return s}),window.Handlebars.registerHelper("notEmpty",function(t,e){return t&&Object.keys(t).length>0?e.fn(this):e.inverse(this)}),window.Handlebars.registerHelper("reSub",function(t,e,n){let s=n.fn(this);return"string"!=typeof s?s:s.replace(new RegExp(t,"g"),e)}),window.Handlebars.registerHelper("ifTrue",function(t,e){return 1==t?e.fn(this):e.inverse(this)}),window.Handlebars.registerHelper("ifFalse",function(t,e){return 1==t?e.fn(this):e.inverse(this)}),window.Handlebars.registerHelper("contains",function(t,e,n){return t=window.Handlebars.escapeExpression(t),(e=window.Handlebars.escapeExpression(e)).indexOf(t)>-1?n.fn(this):n.inverse(this)}),window.Handlebars.registerHelper("compare",function(t,e,n,s){var a={"==":t==n,"===":t===n,"!=":t!=n,"!==":t!==n,">":t>n,">=":t>=n,"<":t<n,"<=":t<=n,"||":!(!t&&!n),"&&":!(!t||!n)};return Object.prototype.hasOwnProperty.call(a,e)?a[e]?s.fn(this):s.inverse(this):console.error('Error: Expression "'+e+'" not found')})}},e={};function n(s){var a=e[s];if(void 0!==a)return a.exports;var i=e[s]={exports:{}};return t[s](i,i.exports,n),i.exports}n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n(218),n(290),n(169),n(638)})();